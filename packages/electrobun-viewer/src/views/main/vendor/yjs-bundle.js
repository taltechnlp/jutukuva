var rQ=Object.defineProperty;var tQ=(Z,$)=>{for(var Q in $)rQ(Z,Q,{get:$[Q],enumerable:!0,configurable:!0,set:(J)=>$[Q]=()=>J})};var M$={};tQ(M$,{typeMapGetSnapshot:()=>g7,typeMapGetAllSnapshot:()=>PQ,typeListToArraySnapshot:()=>v7,tryGc:()=>E7,transact:()=>j,snapshotContainsUpdate:()=>R7,snapshot:()=>N7,relativePositionToJSON:()=>e0,readUpdateV2:()=>q6,readUpdate:()=>o0,parseUpdateMetaV2:()=>BQ,parseUpdateMeta:()=>T7,obfuscateUpdateV2:()=>C7,obfuscateUpdate:()=>I7,mergeUpdatesV2:()=>P8,mergeUpdates:()=>KQ,mergeDeleteSets:()=>IZ,logUpdateV2:()=>qQ,logUpdate:()=>U7,logType:()=>t0,iterateDeletedStructs:()=>wZ,isParentOf:()=>V8,isDeleted:()=>hZ,getTypeChildren:()=>k7,getState:()=>P,getItemCleanStart:()=>b,getItemCleanEnd:()=>t$,getItem:()=>AZ,findRootTypeKey:()=>H6,findIndexSS:()=>o,equalSnapshots:()=>H7,equalDeleteSets:()=>u4,encodeStateVectorFromUpdateV2:()=>XQ,encodeStateVectorFromUpdate:()=>P7,encodeStateVector:()=>_6,encodeStateAsUpdateV2:()=>i4,encodeStateAsUpdate:()=>K6,encodeSnapshotV2:()=>a4,encodeSnapshot:()=>F7,encodeRelativePosition:()=>q7,emptySnapshot:()=>M7,diffUpdateV2:()=>W6,diffUpdate:()=>w7,decodeUpdateV2:()=>GQ,decodeUpdate:()=>V7,decodeStateVector:()=>X6,decodeSnapshotV2:()=>n4,decodeSnapshot:()=>z7,decodeRelativePosition:()=>K7,createSnapshot:()=>z6,createRelativePositionFromTypeIndex:()=>Q7,createRelativePositionFromJSON:()=>Z7,createID:()=>R,createDocFromSnapshot:()=>W7,createDeleteSetFromStructStore:()=>$6,createDeleteSet:()=>K$,createAbsolutePositionFromRelativePosition:()=>B7,convertUpdateFormatV2ToV1:()=>FQ,convertUpdateFormatV1ToV2:()=>x7,compareRelativePositions:()=>_7,compareIDs:()=>TZ,cleanupYTextFormatting:()=>CQ,applyUpdateV2:()=>X$,applyUpdate:()=>G6,YXmlEvent:()=>V6,YTextEvent:()=>U6,YMapEvent:()=>j6,YEvent:()=>J8,YArrayEvent:()=>E6,XmlText:()=>w8,XmlHook:()=>$8,XmlFragment:()=>OZ,XmlElement:()=>EZ,UpdateEncoderV2:()=>c,UpdateEncoderV1:()=>FZ,UpdateDecoderV2:()=>p,UpdateDecoderV1:()=>l,UndoManager:()=>JQ,Transaction:()=>N6,Text:()=>xZ,Snapshot:()=>B$,Skip:()=>f,RelativePosition:()=>C8,PermanentUserData:()=>o4,Map:()=>YZ,Item:()=>O,ID:()=>RZ,GC:()=>y,Doc:()=>jZ,ContentType:()=>n,ContentString:()=>a,ContentJSON:()=>Q8,ContentFormat:()=>I,ContentEmbed:()=>MZ,ContentDoc:()=>vZ,ContentDeleted:()=>DZ,ContentBinary:()=>kZ,ContentAny:()=>HZ,Array:()=>BZ,AbstractType:()=>x,AbstractStruct:()=>D8,AbstractConnector:()=>p4,AbsolutePosition:()=>F6});var T=()=>new Map,h8=(Z)=>{let $=T();return Z.forEach((Q,J)=>{$.set(J,Q)}),$},S=(Z,$,Q)=>{let J=Z.get($);if(J===void 0)Z.set($,J=Q());return J},h6=(Z,$)=>{let Q=[];for(let[J,q]of Z)Q.push($(q,J));return Q},k6=(Z,$)=>{for(let[Q,J]of Z)if($(J,Q))return!0;return!1};var i=()=>new Set;var v8=(Z)=>Z[Z.length-1];var v6=(Z,$)=>{for(let Q=0;Q<$.length;Q++)Z.push($[Q])},r=Array.from;var b6=(Z,$)=>{for(let Q=0;Q<Z.length;Q++)if($(Z[Q],Q,Z))return!0;return!1};var f6=(Z,$)=>{let Q=new Array(Z);for(let J=0;J<Z;J++)Q[J]=$(J,Q);return Q};var X8=Array.isArray;class UZ{constructor(){this._observers=T()}on(Z,$){return S(this._observers,Z,i).add($),$}once(Z,$){let Q=(...J)=>{this.off(Z,Q),$(...J)};this.on(Z,Q)}off(Z,$){let Q=this._observers.get(Z);if(Q!==void 0){if(Q.delete($),Q.size===0)this._observers.delete(Z)}}emit(Z,$){return r((this._observers.get(Z)||T()).values()).forEach((Q)=>Q(...$))}destroy(){this._observers=T()}}class R${constructor(){this._observers=T()}on(Z,$){S(this._observers,Z,i).add($)}once(Z,$){let Q=(...J)=>{this.off(Z,Q),$(...J)};this.on(Z,Q)}off(Z,$){let Q=this._observers.get(Z);if(Q!==void 0){if(Q.delete($),Q.size===0)this._observers.delete(Z)}}emit(Z,$){return r((this._observers.get(Z)||T()).values()).forEach((Q)=>Q(...$))}destroy(){this._observers=T()}}var m=Math.floor;var yZ=Math.abs;var mZ=(Z,$)=>Z<$?Z:$,GZ=(Z,$)=>Z>$?Z:$,IJ=Number.isNaN,g6=Math.pow;var f8=(Z)=>Z!==0?Z<0:1/Z<0;var Y$=1,O$=2,g8=4,y8=8;var uZ=32,d=64,v=128;var B8=31,_8=63,KZ=127;var y6=2147483647;var{MAX_SAFE_INTEGER:j$,MIN_SAFE_INTEGER:CJ}=Number;var m6=Number.isInteger||((Z)=>typeof Z==="number"&&isFinite(Z)&&m(Z)===Z),xJ=Number.isNaN,DJ=Number.parseInt;var{fromCharCode:U$,fromCodePoint:SJ}=String,hJ=U$(65535),eQ=(Z)=>Z.toLowerCase(),Z0=/^\s*/g,$0=(Z)=>Z.replace(Z0,""),Q0=/([A-Z])/g,V$=(Z,$)=>$0(Z.replace(Q0,(Q)=>`${$}${eQ(Q)}`));var J0=(Z)=>{let $=unescape(encodeURIComponent(Z)),Q=$.length,J=new Uint8Array(Q);for(let q=0;q<Q;q++)J[q]=$.codePointAt(q);return J},iZ=typeof TextEncoder!=="undefined"?new TextEncoder:null,q0=(Z)=>iZ.encode(Z),u6=iZ?q0:J0;var lZ=typeof TextDecoder==="undefined"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});if(lZ&&lZ.decode(new Uint8Array).length===1)lZ=null;var l6=(Z,$)=>f6($,()=>Z).join("");class sZ{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}var A=()=>new sZ;var m8=(Z)=>{let $=Z.cpos;for(let Q=0;Q<Z.bufs.length;Q++)$+=Z.bufs[Q].length;return $};var E=(Z)=>{let $=new Uint8Array(m8(Z)),Q=0;for(let J=0;J<Z.bufs.length;J++){let q=Z.bufs[J];$.set(q,Q),Q+=q.length}return $.set(new Uint8Array(Z.cbuf.buffer,0,Z.cpos),Q),$},G0=(Z,$)=>{let Q=Z.cbuf.length;if(Q-Z.cpos<$)Z.bufs.push(new Uint8Array(Z.cbuf.buffer,0,Z.cpos)),Z.cbuf=new Uint8Array(GZ(Q,$)*2),Z.cpos=0},h=(Z,$)=>{let Q=Z.cbuf.length;if(Z.cpos===Q)Z.bufs.push(Z.cbuf),Z.cbuf=new Uint8Array(Q*2),Z.cpos=0;Z.cbuf[Z.cpos++]=$};var cZ=h;var W=(Z,$)=>{while($>KZ)h(Z,v|KZ&$),$=m($/128);h(Z,KZ&$)},F8=(Z,$)=>{let Q=f8($);if(Q)$=-$;h(Z,($>_8?v:0)|(Q?d:0)|_8&$),$=m($/64);while($>0)h(Z,($>KZ?v:0)|KZ&$),$=m($/128)},P$=new Uint8Array(30000),K0=P$.length/3,X0=(Z,$)=>{if($.length<K0){let Q=iZ.encodeInto($,P$).written||0;W(Z,Q);for(let J=0;J<Q;J++)h(Z,P$[J])}else U(Z,u6($))},B0=(Z,$)=>{let Q=unescape(encodeURIComponent($)),J=Q.length;W(Z,J);for(let q=0;q<J;q++)h(Z,Q.codePointAt(q))},e=iZ&&iZ.encodeInto?X0:B0;var c6=(Z,$)=>oZ(Z,E($)),oZ=(Z,$)=>{let Q=Z.cbuf.length,J=Z.cpos,q=mZ(Q-J,$.length),G=$.length-q;if(Z.cbuf.set($.subarray(0,q),J),Z.cpos+=q,G>0)Z.bufs.push(Z.cbuf),Z.cbuf=new Uint8Array(GZ(Q*2,G)),Z.cbuf.set($.subarray(q)),Z.cpos=G},U=(Z,$)=>{W(Z,$.byteLength),oZ(Z,$)},T$=(Z,$)=>{G0(Z,$);let Q=new DataView(Z.cbuf.buffer,Z.cpos,$);return Z.cpos+=$,Q},_0=(Z,$)=>T$(Z,4).setFloat32(0,$,!1),H0=(Z,$)=>T$(Z,8).setFloat64(0,$,!1),F0=(Z,$)=>T$(Z,8).setBigInt64(0,$,!1);var i6=new DataView(new ArrayBuffer(4)),z0=(Z)=>{return i6.setFloat32(0,Z),i6.getFloat32(0)===Z},dZ=(Z,$)=>{switch(typeof $){case"string":h(Z,119),e(Z,$);break;case"number":if(m6($)&&yZ($)<=y6)h(Z,125),F8(Z,$);else if(z0($))h(Z,124),_0(Z,$);else h(Z,123),H0(Z,$);break;case"bigint":h(Z,122),F0(Z,$);break;case"object":if($===null)h(Z,126);else if(X8($)){h(Z,117),W(Z,$.length);for(let Q=0;Q<$.length;Q++)dZ(Z,$[Q])}else if($ instanceof Uint8Array)h(Z,116),U(Z,$);else{h(Z,118);let Q=Object.keys($);W(Z,Q.length);for(let J=0;J<Q.length;J++){let q=Q[J];e(Z,q),dZ(Z,$[q])}}break;case"boolean":h(Z,$?120:121);break;default:h(Z,127)}};class p8 extends sZ{constructor(Z){super();this.w=Z,this.s=null,this.count=0}write(Z){if(this.s===Z)this.count++;else{if(this.count>0)W(this,this.count-1);this.count=1,this.w(this,Z),this.s=Z}}}var d6=(Z)=>{if(Z.count>0){if(F8(Z.encoder,Z.count===1?Z.s:-Z.s),Z.count>1)W(Z.encoder,Z.count-2)}};class aZ{constructor(){this.encoder=new sZ,this.s=0,this.count=0}write(Z){if(this.s===Z)this.count++;else d6(this),this.count=1,this.s=Z}toUint8Array(){return d6(this),E(this.encoder)}}var s6=(Z)=>{if(Z.count>0){let $=Z.diff*2+(Z.count===1?0:1);if(F8(Z.encoder,$),Z.count>1)W(Z.encoder,Z.count-2)}};class z8{constructor(){this.encoder=new sZ,this.s=0,this.count=0,this.diff=0}write(Z){if(this.diff===Z-this.s)this.s=Z,this.count++;else s6(this),this.count=1,this.diff=Z-this.s,this.s=Z}toUint8Array(){return s6(this),E(this.encoder)}}class A${constructor(){this.sarr=[],this.s="",this.lensE=new aZ}write(Z){if(this.s+=Z,this.s.length>19)this.sarr.push(this.s),this.s="";this.lensE.write(Z.length)}toUint8Array(){let Z=new sZ;return this.sarr.push(this.s),this.s="",e(Z,this.sarr.join("")),oZ(Z,this.lensE.toUint8Array()),E(Z)}}var ZZ=(Z)=>new Error(Z),t=()=>{throw ZZ("Method unimplemented")},g=()=>{throw ZZ("Unexpected case")};var a6=ZZ("Unexpected end of array"),n6=ZZ("Integer out of Range");class M8{constructor(Z){this.arr=Z,this.pos=0}}var w=(Z)=>new M8(Z),w$=(Z)=>Z.pos!==Z.arr.length;var M0=(Z,$)=>{let Q=new Uint8Array(Z.arr.buffer,Z.pos+Z.arr.byteOffset,$);return Z.pos+=$,Q},D=(Z)=>M0(Z,L(Z));var VZ=(Z)=>Z.arr[Z.pos++];var L=(Z)=>{let $=0,Q=1,J=Z.arr.length;while(Z.pos<J){let q=Z.arr[Z.pos++];if($=$+(q&KZ)*Q,Q*=128,q<v)return $;if($>j$)throw n6}throw a6},N8=(Z)=>{let $=Z.arr[Z.pos++],Q=$&_8,J=64,q=($&d)>0?-1:1;if(($&v)===0)return q*Q;let G=Z.arr.length;while(Z.pos<G){if($=Z.arr[Z.pos++],Q=Q+($&KZ)*J,J*=128,$<v)return q*Q;if(Q>j$)throw n6}throw a6};var N0=(Z)=>{let $=L(Z);if($===0)return"";else{let Q=String.fromCodePoint(VZ(Z));if(--$<100)while($--)Q+=String.fromCodePoint(VZ(Z));else while($>0){let J=$<1e4?$:1e4,q=Z.arr.subarray(Z.pos,Z.pos+J);Z.pos+=J,Q+=String.fromCodePoint.apply(null,q),$-=J}return decodeURIComponent(escape(Q))}},W0=(Z)=>lZ.decode(D(Z)),s=lZ?W0:N0;var I$=(Z,$)=>{let Q=new DataView(Z.arr.buffer,Z.arr.byteOffset+Z.pos,$);return Z.pos+=$,Q},L0=(Z)=>I$(Z,4).getFloat32(0,!1),R0=(Z)=>I$(Z,8).getFloat64(0,!1),Y0=(Z)=>I$(Z,8).getBigInt64(0,!1);var O0=[(Z)=>{return},(Z)=>null,N8,L0,R0,Y0,(Z)=>!1,(Z)=>!0,s,(Z)=>{let $=L(Z),Q={};for(let J=0;J<$;J++){let q=s(Z);Q[q]=nZ(Z)}return Q},(Z)=>{let $=L(Z),Q=[];for(let J=0;J<$;J++)Q.push(nZ(Z));return Q},D],nZ=(Z)=>O0[127-VZ(Z)](Z);class l8 extends M8{constructor(Z,$){super(Z);this.reader=$,this.s=null,this.count=0}read(){if(this.count===0)if(this.s=this.reader(this),w$(this))this.count=L(this)+1;else this.count=-1;return this.count--,this.s}}class rZ extends M8{constructor(Z){super(Z);this.s=0,this.count=0}read(){if(this.count===0){this.s=N8(this);let Z=f8(this.s);if(this.count=1,Z)this.s=-this.s,this.count=L(this)+2}return this.count--,this.s}}class W8 extends M8{constructor(Z){super(Z);this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){let Z=N8(this),$=Z&1;if(this.diff=m(Z/2),this.count=1,$)this.count=L(this)+2}return this.s+=this.diff,this.count--,this.s}}class C${constructor(Z){this.decoder=new rZ(Z),this.str=s(this.decoder),this.spos=0}read(){let Z=this.spos+this.decoder.read(),$=this.str.slice(this.spos,Z);return this.spos=Z,$}}var bJ=crypto.subtle,r6=crypto.getRandomValues.bind(crypto);var x$=()=>r6(new Uint32Array(1))[0];var E0=[1e7]+-1000+-4000+-8000+-100000000000,t6=()=>E0.replace(/[018]/g,(Z)=>(Z^x$()&15>>Z/4).toString(16));var u=Date.now;var D$=(Z)=>new Promise(Z);var yJ=Promise.all.bind(Promise);var S$=(Z)=>Z===void 0?null:Z;class e6{constructor(){this.map=new Map}setItem(Z,$){this.map.set(Z,$)}getItem(Z){return this.map.get(Z)}}var Z4=new e6,h$=!0;try{if(typeof localStorage!=="undefined"&&localStorage)Z4=localStorage,h$=!1}catch(Z){}var d8=Z4,$4=(Z)=>h$||addEventListener("storage",Z),Q4=(Z)=>h$||removeEventListener("storage",Z);var{assign:G4,keys:K4}=Object;var X4=(Z,$)=>{for(let Q in Z)$(Z[Q],Q)},B4=(Z,$)=>{let Q=[];for(let J in Z)Q.push($(Z[J],J));return Q},k$=(Z)=>K4(Z).length,q4=(Z)=>K4(Z).length;var _4=(Z)=>{for(let $ in Z)return!1;return!0},P0=(Z,$)=>{for(let Q in Z)if(!$(Z[Q],Q))return!1;return!0},v$=(Z,$)=>Object.prototype.hasOwnProperty.call(Z,$),b$=(Z,$)=>Z===$||q4(Z)===q4($)&&P0(Z,(Q,J)=>(Q!==void 0||v$($,J))&&$[J]===Q),T0=Object.freeze,f$=(Z)=>{for(let $ in Z){let Q=Z[$];if(typeof Q==="object"||typeof Q==="function")f$(Z[$])}return T0(Z)};var y$=Symbol("Equality");var R8=(Z,$,Q=0)=>{try{for(;Q<Z.length;Q++)Z[Q](...$)}finally{if(Q<Z.length)R8(Z,$,Q+1)}};var m$=(Z)=>Z;var tZ=(Z,$)=>{if(Z===$)return!0;if(Z==null||$==null||Z.constructor!==$.constructor)return!1;if(Z[y$]!=null)return Z[y$]($);switch(Z.constructor){case ArrayBuffer:Z=new Uint8Array(Z),$=new Uint8Array($);case Uint8Array:{if(Z.byteLength!==$.byteLength)return!1;for(let Q=0;Q<Z.length;Q++)if(Z[Q]!==$[Q])return!1;break}case Set:{if(Z.size!==$.size)return!1;for(let Q of Z)if(!$.has(Q))return!1;break}case Map:{if(Z.size!==$.size)return!1;for(let Q of Z.keys())if(!$.has(Q)||!tZ(Z.get(Q),$.get(Q)))return!1;break}case Object:if(k$(Z)!==k$($))return!1;for(let Q in Z)if(!v$(Z,Q)||!tZ(Z[Q],$[Q]))return!1;break;case Array:if(Z.length!==$.length)return!1;for(let Q=0;Q<Z.length;Q++)if(!tZ(Z[Q],$[Q]))return!1;break;default:return!1}return!0},H4=(Z,$)=>$.includes(Z);var XZ=typeof process!=="undefined"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process!=="undefined"?process:0)==="[object process]",s8=typeof window!=="undefined"&&typeof document!=="undefined"&&!XZ,mJ=typeof navigator!=="undefined"?/Mac/.test(navigator.platform):!1,$Z,w0=[],I0=()=>{if($Z===void 0)if(XZ){$Z=T();let Z=process.argv,$=null;for(let Q=0;Q<Z.length;Q++){let J=Z[Q];if(J[0]==="-"){if($!==null)$Z.set($,"");$=J}else if($!==null)$Z.set($,J),$=null;else w0.push(J)}if($!==null)$Z.set($,"")}else if(typeof location==="object")$Z=T(),(location.search||"?").slice(1).split("&").forEach((Z)=>{if(Z.length!==0){let[$,Q]=Z.split("=");$Z.set(`--${V$($,"-")}`,Q),$Z.set(`-${V$($,"-")}`,Q)}});else $Z=T();return $Z},u$=(Z)=>I0().has(Z);var Y8=(Z)=>XZ?S$(process.env[Z.toUpperCase().replaceAll("-","_")]):S$(d8.getItem(Z));var F4=(Z)=>u$("--"+Z)||Y8(Z)!==null,pJ=F4("production"),C0=XZ&&H4(process.env.FORCE_COLOR,["true","1","2"]),z4=C0||!u$("--no-colors")&&!F4("no-color")&&(!XZ||process.stdout.isTTY)&&(!XZ||u$("--color")||Y8("COLORTERM")!==null||(Y8("TERM")||"").includes("color"));var M4=(Z)=>new Uint8Array(Z),x0=(Z,$,Q)=>new Uint8Array(Z,$,Q),N4=(Z)=>new Uint8Array(Z),D0=(Z)=>{let $="";for(let Q=0;Q<Z.byteLength;Q++)$+=U$(Z[Q]);return btoa($)},S0=(Z)=>Buffer.from(Z.buffer,Z.byteOffset,Z.byteLength).toString("base64"),h0=(Z)=>{let $=atob(Z),Q=M4($.length);for(let J=0;J<$.length;J++)Q[J]=$.charCodeAt(J);return Q},k0=(Z)=>{let $=Buffer.from(Z,"base64");return x0($.buffer,$.byteOffset,$.byteLength)},W4=s8?D0:S0,L4=s8?h0:k0;var R4=(Z)=>{let $=M4(Z.byteLength);return $.set(Z),$};class O4{constructor(Z,$){this.left=Z,this.right=$}}var QZ=(Z,$)=>new O4(Z,$);var PZ=typeof document!=="undefined"?document:{};var uJ=typeof DOMParser!=="undefined"?new DOMParser:null;var E4=(Z)=>h6(Z,($,Q)=>`${Q}:${$};`).join("");var{ELEMENT_NODE:lJ,TEXT_NODE:iJ,CDATA_SECTION_NODE:dJ,COMMENT_NODE:sJ,DOCUMENT_NODE:cJ,DOCUMENT_TYPE_NODE:oJ,DOCUMENT_FRAGMENT_NODE:aJ}=PZ;var JZ=Symbol;var O8=JZ(),E8=JZ(),l$=JZ(),i$=JZ(),d$=JZ(),j8=JZ(),s$=JZ(),eZ=JZ(),c$=JZ(),j4=(Z)=>{if(Z.length===1&&Z[0]?.constructor===Function)Z=Z[0]();let $=[],Q=[],J=0;for(;J<Z.length;J++){let q=Z[J];if(q===void 0)break;else if(q.constructor===String||q.constructor===Number)$.push(q);else if(q.constructor===Object)break}if(J>0)Q.push($.join(""));for(;J<Z.length;J++){let q=Z[J];if(!(q instanceof Symbol))Q.push(q)}return Q};var nJ=u();var y0={[O8]:QZ("font-weight","bold"),[E8]:QZ("font-weight","normal"),[l$]:QZ("color","blue"),[d$]:QZ("color","green"),[i$]:QZ("color","grey"),[j8]:QZ("color","red"),[s$]:QZ("color","purple"),[eZ]:QZ("color","orange"),[c$]:QZ("color","black")},m0=(Z)=>{if(Z.length===1&&Z[0]?.constructor===Function)Z=Z[0]();let $=[],Q=[],J=T(),q=[],G=0;for(;G<Z.length;G++){let K=Z[G],X=y0[K];if(X!==void 0)J.set(X.left,X.right);else{if(K===void 0)break;if(K.constructor===String||K.constructor===Number){let B=E4(J);if(G>0||B.length>0)$.push("%c"+K),Q.push(B);else $.push(K)}else break}}if(G>0)q=Q,q.unshift($.join(""));for(;G<Z.length;G++){let K=Z[G];if(!(K instanceof Symbol))q.push(K)}return q},U4=z4?m0:j4,o8=(...Z)=>{console.log(...U4(Z)),V4.forEach(($)=>$.print(Z))},o$=(...Z)=>{console.warn(...U4(Z)),Z.unshift(eZ),V4.forEach(($)=>$.print(Z))};var V4=i();var P4=(Z)=>({[Symbol.iterator](){return this},next:Z}),T4=(Z,$)=>P4(()=>{let Q;do Q=Z.next();while(!Q.done&&!$(Q.value));return Q}),a8=(Z,$)=>P4(()=>{let{done:Q,value:J}=Z.next();return{done:Q,value:Q?void 0:$(J)}});class p4 extends UZ{constructor(Z,$){super();this.doc=Z,this.awareness=$}}class G${constructor(Z,$){this.clock=Z,this.len=$}}class SZ{constructor(){this.clients=new Map}}var wZ=(Z,$,Q)=>$.clients.forEach((J,q)=>{let G=Z.doc.store.clients.get(q);if(G!=null){let K=G[G.length-1],X=K.id.clock+K.length;for(let B=0,F=J[B];B<J.length&&F.clock<X;F=J[++B])t4(Z,G,F.clock,F.len,Q)}}),l0=(Z,$)=>{let Q=0,J=Z.length-1;while(Q<=J){let q=m((Q+J)/2),G=Z[q],K=G.clock;if(K<=$){if($<K+G.len)return q;Q=q+1}else J=q-1}return null},hZ=(Z,$)=>{let Q=Z.clients.get($.client);return Q!==void 0&&l0(Q,$.clock)!==null},Z6=(Z)=>{Z.clients.forEach(($)=>{$.sort((q,G)=>q.clock-G.clock);let Q,J;for(Q=1,J=1;Q<$.length;Q++){let q=$[J-1],G=$[Q];if(q.clock+q.len>=G.clock)q.len=GZ(q.len,G.clock+G.len-q.clock);else{if(J<Q)$[J]=G;J++}}$.length=J})},IZ=(Z)=>{let $=new SZ;for(let Q=0;Q<Z.length;Q++)Z[Q].clients.forEach((J,q)=>{if(!$.clients.has(q)){let G=J.slice();for(let K=Q+1;K<Z.length;K++)v6(G,Z[K].clients.get(q)||[]);$.clients.set(q,G)}});return Z6($),$},U8=(Z,$,Q,J)=>{S(Z.clients,$,()=>[]).push(new G$(Q,J))},K$=()=>new SZ,$6=(Z)=>{let $=K$();return Z.clients.forEach((Q,J)=>{let q=[];for(let G=0;G<Q.length;G++){let K=Q[G];if(K.deleted){let X=K.id.clock,B=K.length;if(G+1<Q.length)for(let F=Q[G+1];G+1<Q.length&&F.deleted;F=Q[++G+1])B+=F.length;q.push(new G$(X,B))}}if(q.length>0)$.clients.set(J,q)}),$},qZ=(Z,$)=>{W(Z.restEncoder,$.clients.size),r($.clients.entries()).sort((Q,J)=>J[0]-Q[0]).forEach(([Q,J])=>{Z.resetDsCurVal(),W(Z.restEncoder,Q);let q=J.length;W(Z.restEncoder,q);for(let G=0;G<q;G++){let K=J[G];Z.writeDsClock(K.clock),Z.writeDsLen(K.len)}})},_Z=(Z)=>{let $=new SZ,Q=L(Z.restDecoder);for(let J=0;J<Q;J++){Z.resetDsCurVal();let q=L(Z.restDecoder),G=L(Z.restDecoder);if(G>0){let K=S($.clients,q,()=>[]);for(let X=0;X<G;X++)K.push(new G$(Z.readDsClock(),Z.readDsLen()))}}return $},A4=(Z,$,Q)=>{let J=new SZ,q=L(Z.restDecoder);for(let G=0;G<q;G++){Z.resetDsCurVal();let K=L(Z.restDecoder),X=L(Z.restDecoder),B=Q.clients.get(K)||[],F=P(Q,K);for(let _=0;_<X;_++){let H=Z.readDsClock(),z=H+Z.readDsLen();if(H<F){if(F<z)U8(J,K,F,z-F);let M=o(B,H),N=B[M];if(!N.deleted&&N.id.clock<H)B.splice(M+1,0,q$($,N,H-N.id.clock)),M++;while(M<B.length)if(N=B[M++],N.id.clock<z){if(!N.deleted){if(z<N.id.clock+N.length)B.splice(M,0,q$($,N,z-N.id.clock));N.delete($)}}else break}else U8(J,K,H,z-H)}}if(J.clients.size>0){let G=new c;return W(G.restEncoder,0),qZ(G,J),G.toUint8Array()}return null},u4=(Z,$)=>{if(Z.clients.size!==$.clients.size)return!1;for(let[Q,J]of Z.clients.entries()){let q=$.clients.get(Q);if(q===void 0||J.length!==q.length)return!1;for(let G=0;G<J.length;G++){let K=J[G],X=q[G];if(K.clock!==X.clock||K.len!==X.len)return!1}}return!0},l4=x$;class jZ extends UZ{constructor({guid:Z=t6(),collectionid:$=null,gc:Q=!0,gcFilter:J=()=>!0,meta:q=null,autoLoad:G=!1,shouldLoad:K=!0}={}){super();this.gc=Q,this.gcFilter=J,this.clientID=l4(),this.guid=Z,this.collectionid=$,this.share=new Map,this.store=new M6,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=K,this.autoLoad=G,this.meta=q,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=D$((B)=>{this.on("load",()=>{this.isLoaded=!0,B(this)})});let X=()=>D$((B)=>{let F=(_)=>{if(_===void 0||_===!0)this.off("sync",F),B()};this.on("sync",F)});this.on("sync",(B)=>{if(B===!1&&this.isSynced)this.whenSynced=X();if(this.isSynced=B===void 0||B===!0,this.isSynced&&!this.isLoaded)this.emit("load",[this])}),this.whenSynced=X()}load(){let Z=this._item;if(Z!==null&&!this.shouldLoad)j(Z.parent.doc,($)=>{$.subdocsLoaded.add(this)},null,!0);this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(r(this.subdocs).map((Z)=>Z.guid))}transact(Z,$=null){return j(this,Z,$)}get(Z,$=x){let Q=S(this.share,Z,()=>{let q=new $;return q._integrate(this,null),q}),J=Q.constructor;if($!==x&&J!==$)if(J===x){let q=new $;q._map=Q._map,Q._map.forEach((G)=>{for(;G!==null;G=G.left)G.parent=q}),q._start=Q._start;for(let G=q._start;G!==null;G=G.right)G.parent=q;return q._length=Q._length,this.share.set(Z,q),q._integrate(this,null),q}else throw new Error(`Type with the name ${Z} has already been defined with a different constructor`);return Q}getArray(Z=""){return this.get(Z,BZ)}getText(Z=""){return this.get(Z,xZ)}getMap(Z=""){return this.get(Z,YZ)}getXmlElement(Z=""){return this.get(Z,EZ)}getXmlFragment(Z=""){return this.get(Z,OZ)}toJSON(){let Z={};return this.share.forEach(($,Q)=>{Z[Q]=$.toJSON()}),Z}destroy(){this.isDestroyed=!0,r(this.subdocs).forEach(($)=>$.destroy());let Z=this._item;if(Z!==null){this._item=null;let $=Z.content;$.doc=new jZ({guid:this.guid,...$.opts,shouldLoad:!1}),$.doc._item=Z,j(Z.parent.doc,(Q)=>{let J=$.doc;if(!Z.deleted)Q.subdocsAdded.add(J);Q.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class Z8{constructor(Z){this.restDecoder=Z}resetDsCurVal(){}readDsClock(){return L(this.restDecoder)}readDsLen(){return L(this.restDecoder)}}class l extends Z8{readLeftID(){return R(L(this.restDecoder),L(this.restDecoder))}readRightID(){return R(L(this.restDecoder),L(this.restDecoder))}readClient(){return L(this.restDecoder)}readInfo(){return VZ(this.restDecoder)}readString(){return s(this.restDecoder)}readParentInfo(){return L(this.restDecoder)===1}readTypeRef(){return L(this.restDecoder)}readLen(){return L(this.restDecoder)}readAny(){return nZ(this.restDecoder)}readBuf(){return R4(D(this.restDecoder))}readJSON(){return JSON.parse(s(this.restDecoder))}readKey(){return s(this.restDecoder)}}class Q6{constructor(Z){this.dsCurrVal=0,this.restDecoder=Z}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=L(this.restDecoder),this.dsCurrVal}readDsLen(){let Z=L(this.restDecoder)+1;return this.dsCurrVal+=Z,Z}}class p extends Q6{constructor(Z){super(Z);this.keys=[],L(Z),this.keyClockDecoder=new W8(D(Z)),this.clientDecoder=new rZ(D(Z)),this.leftClockDecoder=new W8(D(Z)),this.rightClockDecoder=new W8(D(Z)),this.infoDecoder=new l8(D(Z),VZ),this.stringDecoder=new C$(D(Z)),this.parentInfoDecoder=new l8(D(Z),VZ),this.typeRefDecoder=new rZ(D(Z)),this.lenDecoder=new rZ(D(Z))}readLeftID(){return new RZ(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new RZ(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return nZ(this.restDecoder)}readBuf(){return D(this.restDecoder)}readJSON(){return nZ(this.restDecoder)}readKey(){let Z=this.keyClockDecoder.read();if(Z<this.keys.length)return this.keys[Z];else{let $=this.stringDecoder.read();return this.keys.push($),$}}}class CZ{constructor(){this.restEncoder=A()}toUint8Array(){return E(this.restEncoder)}resetDsCurVal(){}writeDsClock(Z){W(this.restEncoder,Z)}writeDsLen(Z){W(this.restEncoder,Z)}}class FZ extends CZ{writeLeftID(Z){W(this.restEncoder,Z.client),W(this.restEncoder,Z.clock)}writeRightID(Z){W(this.restEncoder,Z.client),W(this.restEncoder,Z.clock)}writeClient(Z){W(this.restEncoder,Z)}writeInfo(Z){cZ(this.restEncoder,Z)}writeString(Z){e(this.restEncoder,Z)}writeParentInfo(Z){W(this.restEncoder,Z?1:0)}writeTypeRef(Z){W(this.restEncoder,Z)}writeLen(Z){W(this.restEncoder,Z)}writeAny(Z){dZ(this.restEncoder,Z)}writeBuf(Z){U(this.restEncoder,Z)}writeJSON(Z){e(this.restEncoder,JSON.stringify(Z))}writeKey(Z){e(this.restEncoder,Z)}}class I8{constructor(){this.restEncoder=A(),this.dsCurrVal=0}toUint8Array(){return E(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(Z){let $=Z-this.dsCurrVal;this.dsCurrVal=Z,W(this.restEncoder,$)}writeDsLen(Z){if(Z===0)g();W(this.restEncoder,Z-1),this.dsCurrVal+=Z}}class c extends I8{constructor(){super();this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new z8,this.clientEncoder=new aZ,this.leftClockEncoder=new z8,this.rightClockEncoder=new z8,this.infoEncoder=new p8(cZ),this.stringEncoder=new A$,this.parentInfoEncoder=new p8(cZ),this.typeRefEncoder=new aZ,this.lenEncoder=new aZ}toUint8Array(){let Z=A();return W(Z,0),U(Z,this.keyClockEncoder.toUint8Array()),U(Z,this.clientEncoder.toUint8Array()),U(Z,this.leftClockEncoder.toUint8Array()),U(Z,this.rightClockEncoder.toUint8Array()),U(Z,E(this.infoEncoder)),U(Z,this.stringEncoder.toUint8Array()),U(Z,E(this.parentInfoEncoder)),U(Z,this.typeRefEncoder.toUint8Array()),U(Z,this.lenEncoder.toUint8Array()),oZ(Z,E(this.restEncoder)),E(Z)}writeLeftID(Z){this.clientEncoder.write(Z.client),this.leftClockEncoder.write(Z.clock)}writeRightID(Z){this.clientEncoder.write(Z.client),this.rightClockEncoder.write(Z.clock)}writeClient(Z){this.clientEncoder.write(Z)}writeInfo(Z){this.infoEncoder.write(Z)}writeString(Z){this.stringEncoder.write(Z)}writeParentInfo(Z){this.parentInfoEncoder.write(Z?1:0)}writeTypeRef(Z){this.typeRefEncoder.write(Z)}writeLen(Z){this.lenEncoder.write(Z)}writeAny(Z){dZ(this.restEncoder,Z)}writeBuf(Z){U(this.restEncoder,Z)}writeJSON(Z){dZ(this.restEncoder,Z)}writeKey(Z){let $=this.keyMap.get(Z);if($===void 0)this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(Z);else this.keyClockEncoder.write($)}}var i0=(Z,$,Q,J)=>{J=GZ(J,$[0].id.clock);let q=o($,J);W(Z.restEncoder,$.length-q),Z.writeClient(Q),W(Z.restEncoder,J);let G=$[q];G.write(Z,J-G.id.clock);for(let K=q+1;K<$.length;K++)$[K].write(Z,0)},J6=(Z,$,Q)=>{let J=new Map;Q.forEach((q,G)=>{if(P($,G)>q)J.set(G,q)}),x8($).forEach((q,G)=>{if(!Q.has(G))J.set(G,0)}),W(Z.restEncoder,J.size),r(J.entries()).sort((q,G)=>G[0]-q[0]).forEach(([q,G])=>{i0(Z,$.clients.get(q),q,G)})},d0=(Z,$)=>{let Q=T(),J=L(Z.restDecoder);for(let q=0;q<J;q++){let G=L(Z.restDecoder),K=new Array(G),X=Z.readClient(),B=L(Z.restDecoder);Q.set(X,{i:0,refs:K});for(let F=0;F<G;F++){let _=Z.readInfo();switch(B8&_){case 0:{let H=Z.readLen();K[F]=new y(R(X,B),H),B+=H;break}case 10:{let H=L(Z.restDecoder);K[F]=new f(R(X,B),H),B+=H;break}default:{let H=(_&(d|v))===0,z=new O(R(X,B),null,(_&v)===v?Z.readLeftID():null,null,(_&d)===d?Z.readRightID():null,H?Z.readParentInfo()?$.get(Z.readString()):Z.readLeftID():null,H&&(_&uZ)===uZ?Z.readString():null,SQ(Z,_));K[F]=z,B+=z.length}}}}return Q},s0=(Z,$,Q)=>{let J=[],q=r(Q.keys()).sort((M,N)=>M-N);if(q.length===0)return null;let G=()=>{if(q.length===0)return null;let M=Q.get(q[q.length-1]);while(M.refs.length===M.i)if(q.pop(),q.length>0)M=Q.get(q[q.length-1]);else return null;return M},K=G();if(K===null)return null;let X=new M6,B=new Map,F=(M,N)=>{let Y=B.get(M);if(Y==null||Y>N)B.set(M,N)},_=K.refs[K.i++],H=new Map,z=()=>{for(let M of J){let N=M.id.client,Y=Q.get(N);if(Y)Y.i--,X.clients.set(N,Y.refs.slice(Y.i)),Q.delete(N),Y.i=0,Y.refs=[];else X.clients.set(N,[M]);q=q.filter((V)=>V!==N)}J.length=0};while(!0){if(_.constructor!==f){let N=S(H,_.id.client,()=>P($,_.id.client))-_.id.clock;if(N<0)J.push(_),F(_.id.client,_.id.clock-1),z();else{let Y=_.getMissing(Z,$);if(Y!==null){J.push(_);let V=Q.get(Y)||{refs:[],i:0};if(V.refs.length===V.i)F(Y,P($,Y)),z();else{_=V.refs[V.i++];continue}}else if(N===0||N<_.length)_.integrate(Z,N),H.set(_.id.client,_.id.clock+_.length)}}if(J.length>0)_=J.pop();else if(K!==null&&K.i<K.refs.length)_=K.refs[K.i++];else if(K=G(),K===null)break;else _=K.refs[K.i++]}if(X.clients.size>0){let M=new c;return J6(M,X,new Map),W(M.restEncoder,0),{missing:B,update:M.toUint8Array()}}return null},c0=(Z,$)=>J6(Z,$.doc.store,$.beforeState),q6=(Z,$,Q,J=new p(Z))=>j($,(q)=>{q.local=!1;let G=!1,K=q.doc,X=K.store,B=d0(J,K),F=s0(q,X,B),_=X.pendingStructs;if(_){for(let[z,M]of _.missing)if(M<P(X,z)){G=!0;break}if(F){for(let[z,M]of F.missing){let N=_.missing.get(z);if(N==null||N>M)_.missing.set(z,M)}_.update=P8([_.update,F.update])}}else X.pendingStructs=F;let H=A4(J,q,X);if(X.pendingDs){let z=new p(w(X.pendingDs));L(z.restDecoder);let M=A4(z,q,X);if(H&&M)X.pendingDs=P8([H,M]);else X.pendingDs=H||M}else X.pendingDs=H;if(G){let z=X.pendingStructs.update;X.pendingStructs=null,X$(q.doc,z)}},Q,!1),o0=(Z,$,Q)=>q6(Z,$,Q,new l(Z)),X$=(Z,$,Q,J=p)=>{let q=w($);q6(q,Z,Q,new J(q))},G6=(Z,$,Q)=>X$(Z,$,Q,l),a0=(Z,$,Q=new Map)=>{J6(Z,$.store,Q),qZ(Z,$6($.store))},i4=(Z,$=new Uint8Array([0]),Q=new c)=>{let J=X6($);a0(Q,Z,J);let q=[Q.toUint8Array()];if(Z.store.pendingDs)q.push(Z.store.pendingDs);if(Z.store.pendingStructs)q.push(W6(Z.store.pendingStructs.update,$));if(q.length>1){if(Q.constructor===FZ)return KQ(q.map((G,K)=>K===0?G:FQ(G)));else if(Q.constructor===c)return P8(q)}return q[0]},K6=(Z,$)=>i4(Z,$,new FZ),d4=(Z)=>{let $=new Map,Q=L(Z.restDecoder);for(let J=0;J<Q;J++){let q=L(Z.restDecoder),G=L(Z.restDecoder);$.set(q,G)}return $},X6=(Z)=>d4(new Z8(w(Z))),B6=(Z,$)=>{return W(Z.restEncoder,$.size),r($.entries()).sort((Q,J)=>J[0]-Q[0]).forEach(([Q,J])=>{W(Z.restEncoder,Q),W(Z.restEncoder,J)}),Z},n0=(Z,$)=>B6(Z,x8($.store)),r0=(Z,$=new I8)=>{if(Z instanceof Map)B6($,Z);else n0($,Z);return $.toUint8Array()},_6=(Z)=>r0(Z,new CZ);class s4{constructor(){this.l=[]}}var w4=()=>new s4,I4=(Z,$)=>Z.l.push($),C4=(Z,$)=>{let Q=Z.l,J=Q.length;if(Z.l=Q.filter((q)=>$!==q),J===Z.l.length)console.error("[yjs] Tried to remove event handler that doesn't exist.")},c4=(Z,$,Q)=>R8(Z.l,[$,Q]);class RZ{constructor(Z,$){this.client=Z,this.clock=$}}var TZ=(Z,$)=>Z===$||Z!==null&&$!==null&&Z.client===$.client&&Z.clock===$.clock,R=(Z,$)=>new RZ(Z,$),x4=(Z,$)=>{W(Z,$.client),W(Z,$.clock)},D4=(Z)=>R(L(Z),L(Z)),H6=(Z)=>{for(let[$,Q]of Z.doc.share.entries())if(Q===Z)return $;throw g()},V8=(Z,$)=>{while($!==null){if($.parent===Z)return!0;$=$.parent._item}return!1},t0=(Z)=>{let $=[],Q=Z._start;while(Q)$.push(Q),Q=Q.right;console.log("Children: ",$),console.log("Children content: ",$.filter((J)=>!J.deleted).map((J)=>J.content))};class o4{constructor(Z,$=Z.getMap("users")){let Q=new Map;this.yusers=$,this.doc=Z,this.clients=new Map,this.dss=Q;let J=(q,G)=>{let K=q.get("ds"),X=q.get("ids"),B=(F)=>this.clients.set(F,G);K.observe((F)=>{F.changes.added.forEach((_)=>{_.content.getContent().forEach((H)=>{if(H instanceof Uint8Array)this.dss.set(G,IZ([this.dss.get(G)||K$(),_Z(new Z8(w(H)))]))})})}),this.dss.set(G,IZ(K.map((F)=>_Z(new Z8(w(F)))))),X.observe((F)=>F.changes.added.forEach((_)=>_.content.getContent().forEach(B))),X.forEach(B)};$.observe((q)=>{q.keysChanged.forEach((G)=>J($.get(G),G))}),$.forEach(J)}setUserMapping(Z,$,Q,{filter:J=()=>!0}={}){let q=this.yusers,G=q.get(Q);if(!G)G=new YZ,G.set("ids",new BZ),G.set("ds",new BZ),q.set(Q,G);G.get("ids").push([$]),q.observe((K)=>{setTimeout(()=>{let X=q.get(Q);if(X!==G){G=X,this.clients.forEach((_,H)=>{if(Q===_)G.get("ids").push([H])});let B=new CZ,F=this.dss.get(Q);if(F)qZ(B,F),G.get("ds").push([B.toUint8Array()])}},0)}),Z.on("afterTransaction",(K)=>{setTimeout(()=>{let X=G.get("ds"),B=K.deleteSet;if(K.local&&B.clients.size>0&&J(K,B)){let F=new CZ;qZ(F,B),X.push([F.toUint8Array()])}})})}getUserByClientId(Z){return this.clients.get(Z)||null}getUserByDeletedId(Z){for(let[$,Q]of this.dss.entries())if(hZ(Q,Z))return $;return null}}class C8{constructor(Z,$,Q,J=0){this.type=Z,this.tname=$,this.item=Q,this.assoc=J}}var e0=(Z)=>{let $={};if(Z.type)$.type=Z.type;if(Z.tname)$.tname=Z.tname;if(Z.item)$.item=Z.item;if(Z.assoc!=null)$.assoc=Z.assoc;return $},Z7=(Z)=>new C8(Z.type==null?null:R(Z.type.client,Z.type.clock),Z.tname??null,Z.item==null?null:R(Z.item.client,Z.item.clock),Z.assoc==null?0:Z.assoc);class F6{constructor(Z,$,Q=0){this.type=Z,this.index=$,this.assoc=Q}}var $7=(Z,$,Q=0)=>new F6(Z,$,Q),n8=(Z,$,Q)=>{let J=null,q=null;if(Z._item===null)q=H6(Z);else J=R(Z._item.id.client,Z._item.id.clock);return new C8(J,q,$,Q)},Q7=(Z,$,Q=0)=>{let J=Z._start;if(Q<0){if($===0)return n8(Z,null,Q);$--}while(J!==null){if(!J.deleted&&J.countable){if(J.length>$)return n8(Z,R(J.id.client,J.id.clock+$),Q);$-=J.length}if(J.right===null&&Q<0)return n8(Z,J.lastId,Q);J=J.right}return n8(Z,null,Q)},J7=(Z,$)=>{let{type:Q,tname:J,item:q,assoc:G}=$;if(q!==null)W(Z,0),x4(Z,q);else if(J!==null)cZ(Z,1),e(Z,J);else if(Q!==null)cZ(Z,2),x4(Z,Q);else throw g();return F8(Z,G),Z},q7=(Z)=>{let $=A();return J7($,Z),E($)},G7=(Z)=>{let $=null,Q=null,J=null;switch(L(Z)){case 0:J=D4(Z);break;case 1:Q=s(Z);break;case 2:$=D4(Z)}let q=w$(Z)?N8(Z):0;return new C8($,Q,J,q)},K7=(Z)=>G7(w(Z)),X7=(Z,$)=>{let Q=AZ(Z,$),J=$.clock-Q.id.clock;return{item:Q,diff:J}},B7=(Z,$,Q=!0)=>{let J=$.store,q=Z.item,G=Z.type,K=Z.tname,X=Z.assoc,B=null,F=0;if(q!==null){if(P(J,q.client)<=q.clock)return null;let _=Q?e$(J,q):X7(J,q),H=_.item;if(!(H instanceof O))return null;if(B=H.parent,B._item===null||!B._item.deleted){F=H.deleted||!H.countable?0:_.diff+(X>=0?0:1);let z=H.left;while(z!==null){if(!z.deleted&&z.countable)F+=z.length;z=z.left}}}else{if(K!==null)B=$.get(K);else if(G!==null){if(P(J,G.client)<=G.clock)return null;let{item:_}=Q?e$(J,G):{item:AZ(J,G)};if(_ instanceof O&&_.content instanceof n)B=_.content.type;else return null}else throw g();if(X>=0)F=B._length;else F=0}return $7(B,F,Z.assoc)},_7=(Z,$)=>Z===$||Z!==null&&$!==null&&Z.tname===$.tname&&TZ(Z.item,$.item)&&TZ(Z.type,$.type)&&Z.assoc===$.assoc;class B${constructor(Z,$){this.ds=Z,this.sv=$}}var H7=(Z,$)=>{let Q=Z.ds.clients,J=$.ds.clients,q=Z.sv,G=$.sv;if(q.size!==G.size||Q.size!==J.size)return!1;for(let[K,X]of q.entries())if(G.get(K)!==X)return!1;for(let[K,X]of Q.entries()){let B=J.get(K)||[];if(X.length!==B.length)return!1;for(let F=0;F<X.length;F++){let _=X[F],H=B[F];if(_.clock!==H.clock||_.len!==H.len)return!1}}return!0},a4=(Z,$=new I8)=>{return qZ($,Z.ds),B6($,Z.sv),$.toUint8Array()},F7=(Z)=>a4(Z,new CZ),n4=(Z,$=new Q6(w(Z)))=>{return new B$(_Z($),d4($))},z7=(Z)=>n4(Z,new Z8(w(Z))),z6=(Z,$)=>new B$(Z,$),M7=z6(K$(),new Map),N7=(Z)=>z6($6(Z.store),x8(Z.store)),NZ=(Z,$)=>$===void 0?!Z.deleted:$.sv.has(Z.id.client)&&($.sv.get(Z.id.client)||0)>Z.id.clock&&!hZ($.ds,Z.id),n$=(Z,$)=>{let Q=S(Z.meta,n$,i),J=Z.doc.store;if(!Q.has($))$.sv.forEach((q,G)=>{if(q<P(J,G))b(Z,R(G,q))}),wZ(Z,$.ds,(q)=>{}),Q.add($)},W7=(Z,$,Q=new jZ)=>{if(Z.gc)throw new Error("Garbage-collection must be disabled in `originDoc`!");let{sv:J,ds:q}=$,G=new c;return Z.transact((K)=>{let X=0;J.forEach((B)=>{if(B>0)X++}),W(G.restEncoder,X);for(let[B,F]of J){if(F===0)continue;if(F<P(Z.store,B))b(K,R(B,F));let _=Z.store.clients.get(B)||[],H=o(_,F-1);W(G.restEncoder,H+1),G.writeClient(B),W(G.restEncoder,0);for(let z=0;z<=H;z++)_[z].write(G,0)}qZ(G,q)}),X$(Q,G.toUint8Array(),"snapshot"),Q},L7=(Z,$,Q=p)=>{let J=new Q(w($)),q=new zZ(J,!1);for(let K=q.curr;K!==null;K=q.next())if((Z.sv.get(K.id.client)||0)<K.id.clock+K.length)return!1;let G=IZ([Z.ds,_Z(J)]);return u4(Z.ds,G)},R7=(Z,$)=>L7(Z,$,l);class M6{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}var x8=(Z)=>{let $=new Map;return Z.clients.forEach((Q,J)=>{let q=Q[Q.length-1];$.set(J,q.id.clock+q.length)}),$},P=(Z,$)=>{let Q=Z.clients.get($);if(Q===void 0)return 0;let J=Q[Q.length-1];return J.id.clock+J.length},r4=(Z,$)=>{let Q=Z.clients.get($.id.client);if(Q===void 0)Q=[],Z.clients.set($.id.client,Q);else{let J=Q[Q.length-1];if(J.id.clock+J.length!==$.id.clock)throw g()}Q.push($)},o=(Z,$)=>{let Q=0,J=Z.length-1,q=Z[J],G=q.id.clock;if(G===$)return J;let K=m($/(G+q.length-1)*J);while(Q<=J){if(q=Z[K],G=q.id.clock,G<=$){if($<G+q.length)return K;Q=K+1}else J=K-1;K=m((Q+J)/2)}throw g()},Y7=(Z,$)=>{let Q=Z.clients.get($.client);return Q[o(Q,$.clock)]},AZ=Y7,r$=(Z,$,Q)=>{let J=o($,Q),q=$[J];if(q.id.clock<Q&&q instanceof O)return $.splice(J+1,0,q$(Z,q,Q-q.id.clock)),J+1;return J},b=(Z,$)=>{let Q=Z.doc.store.clients.get($.client);return Q[r$(Z,Q,$.clock)]},t$=(Z,$,Q)=>{let J=$.clients.get(Q.client),q=o(J,Q.clock),G=J[q];if(Q.clock!==G.id.clock+G.length-1&&G.constructor!==y)J.splice(q+1,0,q$(Z,G,Q.clock-G.id.clock+1));return G},O7=(Z,$,Q)=>{let J=Z.clients.get($.id.client);J[o(J,$.id.clock)]=Q},t4=(Z,$,Q,J,q)=>{if(J===0)return;let G=Q+J,K=r$(Z,$,Q),X;do{if(X=$[K++],G<X.id.clock+X.length)r$(Z,$,G);q(X)}while(K<$.length&&$[K].id.clock<G)};class N6{constructor(Z,$,Q){this.doc=Z,this.deleteSet=new SZ,this.beforeState=x8(Z.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=$,this.meta=new Map,this.local=Q,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}var S4=(Z,$)=>{if($.deleteSet.clients.size===0&&!k6($.afterState,(Q,J)=>$.beforeState.get(J)!==Q))return!1;return Z6($.deleteSet),c0(Z,$),qZ(Z,$.deleteSet),!0},h4=(Z,$,Q)=>{let J=$._item;if(J===null||J.id.clock<(Z.beforeState.get(J.id.client)||0)&&!J.deleted)S(Z.changed,$,i).add(Q)},e8=(Z,$)=>{let Q=Z[$],J=Z[$-1],q=$;for(;q>0;Q=J,J=Z[--q-1]){if(J.deleted===Q.deleted&&J.constructor===Q.constructor){if(J.mergeWith(Q)){if(Q instanceof O&&Q.parentSub!==null&&Q.parent._map.get(Q.parentSub)===Q)Q.parent._map.set(Q.parentSub,J);continue}}break}let G=$-q;if(G)Z.splice($+1-G,G);return G},e4=(Z,$,Q)=>{for(let[J,q]of Z.clients.entries()){let G=$.clients.get(J);for(let K=q.length-1;K>=0;K--){let X=q[K],B=X.clock+X.len;for(let F=o(G,X.clock),_=G[F];F<G.length&&_.id.clock<B;_=G[++F]){let H=G[F];if(X.clock+X.len<=H.id.clock)break;if(H instanceof O&&H.deleted&&!H.keep&&Q(H))H.gc($,!1)}}}},ZQ=(Z,$)=>{Z.clients.forEach((Q,J)=>{let q=$.clients.get(J);for(let G=Q.length-1;G>=0;G--){let K=Q[G],X=mZ(q.length-1,1+o(q,K.clock+K.len-1));for(let B=X,F=q[B];B>0&&F.id.clock>=K.clock;F=q[B])B-=1+e8(q,B)}})},E7=(Z,$,Q)=>{e4(Z,$,Q),ZQ(Z,$)},$Q=(Z,$)=>{if($<Z.length){let Q=Z[$],J=Q.doc,q=J.store,G=Q.deleteSet,K=Q._mergeStructs;try{Z6(G),Q.afterState=x8(Q.doc.store),J.emit("beforeObserverCalls",[Q,J]);let X=[];if(Q.changed.forEach((B,F)=>X.push(()=>{if(F._item===null||!F._item.deleted)F._callObserver(Q,B)})),X.push(()=>{Q.changedParentTypes.forEach((B,F)=>{if(F._dEH.l.length>0&&(F._item===null||!F._item.deleted))B=B.filter((_)=>_.target._item===null||!_.target._item.deleted),B.forEach((_)=>{_.currentTarget=F,_._path=null}),B.sort((_,H)=>_.path.length-H.path.length),c4(F._dEH,B,Q)})}),X.push(()=>J.emit("afterTransaction",[Q,J])),R8(X,[]),Q._needFormattingCleanup)u7(Q)}finally{if(J.gc)e4(G,q,J.gcFilter);ZQ(G,q),Q.afterState.forEach((_,H)=>{let z=Q.beforeState.get(H)||0;if(z!==_){let M=q.clients.get(H),N=GZ(o(M,z),1);for(let Y=M.length-1;Y>=N;)Y-=1+e8(M,Y)}});for(let _=K.length-1;_>=0;_--){let{client:H,clock:z}=K[_].id,M=q.clients.get(H),N=o(M,z);if(N+1<M.length){if(e8(M,N+1)>1)continue}if(N>0)e8(M,N)}if(!Q.local&&Q.afterState.get(J.clientID)!==Q.beforeState.get(J.clientID))o8(eZ,O8,"[yjs] ",E8,j8,"Changed the client-id because another client seems to be using it."),J.clientID=l4();if(J.emit("afterTransactionCleanup",[Q,J]),J._observers.has("update")){let _=new FZ;if(S4(_,Q))J.emit("update",[_.toUint8Array(),Q.origin,J,Q])}if(J._observers.has("updateV2")){let _=new c;if(S4(_,Q))J.emit("updateV2",[_.toUint8Array(),Q.origin,J,Q])}let{subdocsAdded:X,subdocsLoaded:B,subdocsRemoved:F}=Q;if(X.size>0||F.size>0||B.size>0)X.forEach((_)=>{if(_.clientID=J.clientID,_.collectionid==null)_.collectionid=J.collectionid;J.subdocs.add(_)}),F.forEach((_)=>J.subdocs.delete(_)),J.emit("subdocs",[{loaded:B,added:X,removed:F},J,Q]),F.forEach((_)=>_.destroy());if(Z.length<=$+1)J._transactionCleanups=[],J.emit("afterAllTransactions",[J,Z]);else $Q(Z,$+1)}}},j=(Z,$,Q=null,J=!0)=>{let q=Z._transactionCleanups,G=!1,K=null;if(Z._transaction===null){if(G=!0,Z._transaction=new N6(Z,Q,J),q.push(Z._transaction),q.length===1)Z.emit("beforeAllTransactions",[Z]);Z.emit("beforeTransaction",[Z._transaction,Z])}try{K=$(Z._transaction)}finally{if(G){let X=Z._transaction===q[0];if(Z._transaction=null,X)$Q(q,0)}}return K};class QQ{constructor(Z,$){this.insertions=$,this.deletions=Z,this.meta=new Map}}var k4=(Z,$,Q)=>{wZ(Z,Q.deletions,(J)=>{if(J instanceof O&&$.scope.some((q)=>q===Z.doc||V8(q,J)))P6(J,!1)})},v4=(Z,$,Q)=>{let J=null,q=Z.doc,G=Z.scope;j(q,(X)=>{while($.length>0&&Z.currStackItem===null){let B=q.store,F=$.pop(),_=new Set,H=[],z=!1;wZ(X,F.insertions,(M)=>{if(M instanceof O){if(M.redone!==null){let{item:N,diff:Y}=e$(B,M.id);if(Y>0)N=b(X,R(N.id.client,N.id.clock+Y));M=N}if(!M.deleted&&G.some((N)=>N===X.doc||V8(N,M)))H.push(M)}}),wZ(X,F.deletions,(M)=>{if(M instanceof O&&G.some((N)=>N===X.doc||V8(N,M))&&!hZ(F.insertions,M.id))_.add(M)}),_.forEach((M)=>{z=DQ(X,M,_,F.insertions,Z.ignoreRemoteMapChanges,Z)!==null||z});for(let M=H.length-1;M>=0;M--){let N=H[M];if(Z.deleteFilter(N))N.delete(X),z=!0}Z.currStackItem=z?F:null}X.changed.forEach((B,F)=>{if(B.has(null)&&F._searchMarker)F._searchMarker.length=0}),J=X},Z);let K=Z.currStackItem;if(K!=null){let X=J.changedParentTypes;Z.emit("stack-item-popped",[{stackItem:K,type:Q,changedParentTypes:X,origin:Z},Z]),Z.currStackItem=null}return K};class JQ extends UZ{constructor(Z,{captureTimeout:$=500,captureTransaction:Q=(X)=>!0,deleteFilter:J=()=>!0,trackedOrigins:q=new Set([null]),ignoreRemoteMapChanges:G=!1,doc:K=X8(Z)?Z[0].doc:Z instanceof jZ?Z:Z.doc}={}){super();this.scope=[],this.doc=K,this.addToScope(Z),this.deleteFilter=J,q.add(this),this.trackedOrigins=q,this.captureTransaction=Q,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.currStackItem=null,this.lastChange=0,this.ignoreRemoteMapChanges=G,this.captureTimeout=$,this.afterTransactionHandler=(X)=>{if(!this.captureTransaction(X)||!this.scope.some((Y)=>X.changedParentTypes.has(Y)||Y===this.doc)||!this.trackedOrigins.has(X.origin)&&(!X.origin||!this.trackedOrigins.has(X.origin.constructor)))return;let B=this.undoing,F=this.redoing,_=B?this.redoStack:this.undoStack;if(B)this.stopCapturing();else if(!F)this.clear(!1,!0);let H=new SZ;X.afterState.forEach((Y,V)=>{let C=X.beforeState.get(V)||0,S6=Y-C;if(S6>0)U8(H,V,C,S6)});let z=u(),M=!1;if(this.lastChange>0&&z-this.lastChange<this.captureTimeout&&_.length>0&&!B&&!F){let Y=_[_.length-1];Y.deletions=IZ([Y.deletions,X.deleteSet]),Y.insertions=IZ([Y.insertions,H])}else _.push(new QQ(X.deleteSet,H)),M=!0;if(!B&&!F)this.lastChange=z;wZ(X,X.deleteSet,(Y)=>{if(Y instanceof O&&this.scope.some((V)=>V===X.doc||V8(V,Y)))P6(Y,!0)});let N=[{stackItem:_[_.length-1],origin:X.origin,type:B?"redo":"undo",changedParentTypes:X.changedParentTypes},this];if(M)this.emit("stack-item-added",N);else this.emit("stack-item-updated",N)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",()=>{this.destroy()})}addToScope(Z){let $=new Set(this.scope);Z=X8(Z)?Z:[Z],Z.forEach((Q)=>{if(!$.has(Q)){if($.add(Q),Q instanceof x?Q.doc!==this.doc:Q!==this.doc)o$("[yjs#509] Not same Y.Doc");this.scope.push(Q)}})}addTrackedOrigin(Z){this.trackedOrigins.add(Z)}removeTrackedOrigin(Z){this.trackedOrigins.delete(Z)}clear(Z=!0,$=!0){if(Z&&this.canUndo()||$&&this.canRedo())this.doc.transact((Q)=>{if(Z)this.undoStack.forEach((J)=>k4(Q,this,J)),this.undoStack=[];if($)this.redoStack.forEach((J)=>k4(Q,this,J)),this.redoStack=[];this.emit("stack-cleared",[{undoStackCleared:Z,redoStackCleared:$}])})}stopCapturing(){this.lastChange=0}undo(){this.undoing=!0;let Z;try{Z=v4(this,this.undoStack,"undo")}finally{this.undoing=!1}return Z}redo(){this.redoing=!0;let Z;try{Z=v4(this,this.redoStack,"redo")}finally{this.redoing=!1}return Z}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*j7(Z){let $=L(Z.restDecoder);for(let Q=0;Q<$;Q++){let J=L(Z.restDecoder),q=Z.readClient(),G=L(Z.restDecoder);for(let K=0;K<J;K++){let X=Z.readInfo();if(X===10){let B=L(Z.restDecoder);yield new f(R(q,G),B),G+=B}else if((B8&X)!==0){let B=(X&(d|v))===0,F=new O(R(q,G),null,(X&v)===v?Z.readLeftID():null,null,(X&d)===d?Z.readRightID():null,B?Z.readParentInfo()?Z.readString():Z.readLeftID():null,B&&(X&uZ)===uZ?Z.readString():null,SQ(Z,X));yield F,G+=F.length}else{let B=Z.readLen();yield new y(R(q,G),B),G+=B}}}}class zZ{constructor(Z,$){this.gen=j7(Z),this.curr=null,this.done=!1,this.filterSkips=$,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===f);return this.curr}}var U7=(Z)=>qQ(Z,l),qQ=(Z,$=p)=>{let Q=[],J=new $(w(Z)),q=new zZ(J,!1);for(let K=q.curr;K!==null;K=q.next())Q.push(K);o8("Structs: ",Q);let G=_Z(J);o8("DeleteSet: ",G)},V7=(Z)=>GQ(Z,l),GQ=(Z,$=p)=>{let Q=[],J=new $(w(Z)),q=new zZ(J,!1);for(let G=q.curr;G!==null;G=q.next())Q.push(G);return{structs:Q,ds:_Z(J)}};class _${constructor(Z){this.currClient=0,this.startClock=0,this.written=0,this.encoder=Z,this.clientStructs=[]}}var KQ=(Z)=>P8(Z,l,FZ),XQ=(Z,$=I8,Q=p)=>{let J=new $,q=new zZ(new Q(w(Z)),!1),G=q.curr;if(G!==null){let K=0,X=G.id.client,B=G.id.clock!==0,F=B?0:G.id.clock+G.length;for(;G!==null;G=q.next()){if(X!==G.id.client){if(F!==0)K++,W(J.restEncoder,X),W(J.restEncoder,F);X=G.id.client,F=0,B=G.id.clock!==0}if(G.constructor===f)B=!0;if(!B)F=G.id.clock+G.length}if(F!==0)K++,W(J.restEncoder,X),W(J.restEncoder,F);let _=A();return W(_,K),c6(_,J.restEncoder),J.restEncoder=_,J.toUint8Array()}else return W(J.restEncoder,0),J.toUint8Array()},P7=(Z)=>XQ(Z,CZ,l),BQ=(Z,$=p)=>{let Q=new Map,J=new Map,q=new zZ(new $(w(Z)),!1),G=q.curr;if(G!==null){let K=G.id.client,X=G.id.clock;Q.set(K,X);for(;G!==null;G=q.next()){if(K!==G.id.client)J.set(K,X),Q.set(G.id.client,G.id.clock),K=G.id.client;X=G.id.clock+G.length}J.set(K,X)}return{from:Q,to:J}},T7=(Z)=>BQ(Z,l),A7=(Z,$)=>{if(Z.constructor===y){let{client:Q,clock:J}=Z.id;return new y(R(Q,J+$),Z.length-$)}else if(Z.constructor===f){let{client:Q,clock:J}=Z.id;return new f(R(Q,J+$),Z.length-$)}else{let Q=Z,{client:J,clock:q}=Q.id;return new O(R(J,q+$),null,R(J,q+$-1),null,Q.rightOrigin,Q.parent,Q.parentSub,Q.content.splice($))}},P8=(Z,$=p,Q=c)=>{if(Z.length===1)return Z[0];let J=Z.map((_)=>new $(w(_))),q=J.map((_)=>new zZ(_,!0)),G=null,K=new Q,X=new _$(K);while(!0){if(q=q.filter((z)=>z.curr!==null),q.sort((z,M)=>{if(z.curr.id.client===M.curr.id.client){let N=z.curr.id.clock-M.curr.id.clock;if(N===0)return z.curr.constructor===M.curr.constructor?0:z.curr.constructor===f?1:-1;else return N}else return M.curr.id.client-z.curr.id.client}),q.length===0)break;let _=q[0],H=_.curr.id.client;if(G!==null){let z=_.curr,M=!1;while(z!==null&&z.id.clock+z.length<=G.struct.id.clock+G.struct.length&&z.id.client>=G.struct.id.client)z=_.next(),M=!0;if(z===null||z.id.client!==H||M&&z.id.clock>G.struct.id.clock+G.struct.length)continue;if(H!==G.struct.id.client)WZ(X,G.struct,G.offset),G={struct:z,offset:0},_.next();else if(G.struct.id.clock+G.struct.length<z.id.clock)if(G.struct.constructor===f)G.struct.length=z.id.clock+z.length-G.struct.id.clock;else{WZ(X,G.struct,G.offset);let N=z.id.clock-G.struct.id.clock-G.struct.length;G={struct:new f(R(H,G.struct.id.clock+G.struct.length),N),offset:0}}else{let N=G.struct.id.clock+G.struct.length-z.id.clock;if(N>0)if(G.struct.constructor===f)G.struct.length-=N;else z=A7(z,N);if(!G.struct.mergeWith(z))WZ(X,G.struct,G.offset),G={struct:z,offset:0},_.next()}}else G={struct:_.curr,offset:0},_.next();for(let z=_.curr;z!==null&&z.id.client===H&&z.id.clock===G.struct.id.clock+G.struct.length&&z.constructor!==f;z=_.next())WZ(X,G.struct,G.offset),G={struct:z,offset:0}}if(G!==null)WZ(X,G.struct,G.offset),G=null;L6(X);let B=J.map((_)=>_Z(_)),F=IZ(B);return qZ(K,F),K.toUint8Array()},W6=(Z,$,Q=p,J=c)=>{let q=X6($),G=new J,K=new _$(G),X=new Q(w(Z)),B=new zZ(X,!1);while(B.curr){let _=B.curr,H=_.id.client,z=q.get(H)||0;if(B.curr.constructor===f){B.next();continue}if(_.id.clock+_.length>z){WZ(K,_,GZ(z-_.id.clock,0)),B.next();while(B.curr&&B.curr.id.client===H)WZ(K,B.curr,0),B.next()}else while(B.curr&&B.curr.id.client===H&&B.curr.id.clock+B.curr.length<=z)B.next()}L6(K);let F=_Z(X);return qZ(G,F),G.toUint8Array()},w7=(Z,$)=>W6(Z,$,l,FZ),_Q=(Z)=>{if(Z.written>0)Z.clientStructs.push({written:Z.written,restEncoder:E(Z.encoder.restEncoder)}),Z.encoder.restEncoder=A(),Z.written=0},WZ=(Z,$,Q)=>{if(Z.written>0&&Z.currClient!==$.id.client)_Q(Z);if(Z.written===0)Z.currClient=$.id.client,Z.encoder.writeClient($.id.client),W(Z.encoder.restEncoder,$.id.clock+Q);$.write(Z.encoder,Q),Z.written++},L6=(Z)=>{_Q(Z);let $=Z.encoder.restEncoder;W($,Z.clientStructs.length);for(let Q=0;Q<Z.clientStructs.length;Q++){let J=Z.clientStructs[Q];W($,J.written),oZ($,J.restEncoder)}},H$=(Z,$,Q,J)=>{let q=new Q(w(Z)),G=new zZ(q,!1),K=new J,X=new _$(K);for(let F=G.curr;F!==null;F=G.next())WZ(X,$(F),0);L6(X);let B=_Z(q);return qZ(K,B),K.toUint8Array()},HQ=({formatting:Z=!0,subdocs:$=!0,yxml:Q=!0}={})=>{let J=0,q=T(),G=T(),K=T(),X=T();return X.set(null,null),(B)=>{switch(B.constructor){case y:case f:return B;case O:{let F=B,_=F.content;switch(_.constructor){case DZ:break;case n:{if(Q){let H=_.type;if(H instanceof EZ)H.nodeName=S(G,H.nodeName,()=>"node-"+J);if(H instanceof $8)H.hookName=S(G,H.hookName,()=>"hook-"+J)}break}case HZ:{let H=_;H.arr=H.arr.map(()=>J);break}case kZ:{let H=_;H.content=new Uint8Array([J]);break}case vZ:{let H=_;if($)H.opts={},H.doc.guid=J+"";break}case MZ:{let H=_;H.embed={};break}case I:{let H=_;if(Z)H.key=S(K,H.key,()=>J+""),H.value=S(X,H.value,()=>({i:J}));break}case Q8:{let H=_;H.arr=H.arr.map(()=>J);break}case a:{let H=_;H.str=l6(J%10+"",H.str.length);break}default:g()}if(F.parentSub)F.parentSub=S(q,F.parentSub,()=>J+"");return J++,B}default:g()}}},I7=(Z,$)=>H$(Z,HQ($),l,FZ),C7=(Z,$)=>H$(Z,HQ($),p,c),x7=(Z)=>H$(Z,m$,l,c),FQ=(Z)=>H$(Z,m$,p,FZ),b4="You must not compute changes after the event-handler fired.";class J8{constructor(Z,$){this.target=Z,this.currentTarget=Z,this.transaction=$,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=D7(this.currentTarget,this.target))}deletes(Z){return hZ(this.transaction.deleteSet,Z.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw ZZ(b4);let Z=new Map,$=this.target;this.transaction.changed.get($).forEach((J)=>{if(J!==null){let q=$._map.get(J),G,K;if(this.adds(q)){let X=q.left;while(X!==null&&this.adds(X))X=X.left;if(this.deletes(q))if(X!==null&&this.deletes(X))G="delete",K=v8(X.content.getContent());else return;else if(X!==null&&this.deletes(X))G="update",K=v8(X.content.getContent());else G="add",K=void 0}else if(this.deletes(q))G="delete",K=v8(q.content.getContent());else return;Z.set(J,{action:G,oldValue:K})}}),this._keys=Z}return this._keys}get delta(){return this.changes.delta}adds(Z){return Z.id.clock>=(this.transaction.beforeState.get(Z.id.client)||0)}get changes(){let Z=this._changes;if(Z===null){if(this.transaction.doc._transactionCleanups.length===0)throw ZZ(b4);let $=this.target,Q=i(),J=i(),q=[];if(Z={added:Q,deleted:J,delta:q,keys:this.keys},this.transaction.changed.get($).has(null)){let K=null,X=()=>{if(K)q.push(K)};for(let B=$._start;B!==null;B=B.right)if(B.deleted){if(this.deletes(B)&&!this.adds(B)){if(K===null||K.delete===void 0)X(),K={delete:0};K.delete+=B.length,J.add(B)}}else if(this.adds(B)){if(K===null||K.insert===void 0)X(),K={insert:[]};K.insert=K.insert.concat(B.content.getContent()),Q.add(B)}else{if(K===null||K.retain===void 0)X(),K={retain:0};K.retain+=B.length}if(K!==null&&K.retain===void 0)X()}this._changes=Z}return Z}}var D7=(Z,$)=>{let Q=[];while($._item!==null&&$!==Z){if($._item.parentSub!==null)Q.unshift($._item.parentSub);else{let J=0,q=$._item.parent._start;while(q!==$._item&&q!==null){if(!q.deleted&&q.countable)J+=q.length;q=q.right}Q.unshift(J)}$=$._item.parent}return Q},k=()=>{o$("Invalid access: Add Yjs type to a document before reading data.")},zQ=80,R6=0;class MQ{constructor(Z,$){Z.marker=!0,this.p=Z,this.index=$,this.timestamp=R6++}}var S7=(Z)=>{Z.timestamp=R6++},NQ=(Z,$,Q)=>{Z.p.marker=!1,Z.p=$,$.marker=!0,Z.index=Q,Z.timestamp=R6++},h7=(Z,$,Q)=>{if(Z.length>=zQ){let J=Z.reduce((q,G)=>q.timestamp<G.timestamp?q:G);return NQ(J,$,Q),J}else{let J=new MQ($,Q);return Z.push(J),J}},F$=(Z,$)=>{if(Z._start===null||$===0||Z._searchMarker===null)return null;let Q=Z._searchMarker.length===0?null:Z._searchMarker.reduce((G,K)=>yZ($-G.index)<yZ($-K.index)?G:K),J=Z._start,q=0;if(Q!==null)J=Q.p,q=Q.index,S7(Q);while(J.right!==null&&q<$){if(!J.deleted&&J.countable){if($<q+J.length)break;q+=J.length}J=J.right}while(J.left!==null&&q>$)if(J=J.left,!J.deleted&&J.countable)q-=J.length;while(J.left!==null&&J.left.id.client===J.id.client&&J.left.id.clock+J.left.length===J.id.clock)if(J=J.left,!J.deleted&&J.countable)q-=J.length;if(Q!==null&&yZ(Q.index-q)<J.parent.length/zQ)return NQ(Q,J,q),Q;else return h7(Z._searchMarker,J,q)},T8=(Z,$,Q)=>{for(let J=Z.length-1;J>=0;J--){let q=Z[J];if(Q>0){let G=q.p;G.marker=!1;while(G&&(G.deleted||!G.countable))if(G=G.left,G&&!G.deleted&&G.countable)q.index-=G.length;if(G===null||G.marker===!0){Z.splice(J,1);continue}q.p=G,G.marker=!0}if($<q.index||Q>0&&$===q.index)q.index=GZ($,q.index+Q)}},k7=(Z)=>{Z.doc??k();let $=Z._start,Q=[];while($)Q.push($),$=$.right;return Q},z$=(Z,$,Q)=>{let J=Z,q=$.changedParentTypes;while(!0){if(S(q,Z,()=>[]).push(Q),Z._item===null)break;Z=Z._item.parent}c4(J._eH,Q,$)};class x{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=w4(),this._dEH=w4(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(Z,$){this.doc=Z,this._item=$}_copy(){throw t()}clone(){throw t()}_write(Z){}get _first(){let Z=this._start;while(Z!==null&&Z.deleted)Z=Z.right;return Z}_callObserver(Z,$){if(!Z.local&&this._searchMarker)this._searchMarker.length=0}observe(Z){I4(this._eH,Z)}observeDeep(Z){I4(this._dEH,Z)}unobserve(Z){C4(this._eH,Z)}unobserveDeep(Z){C4(this._dEH,Z)}toJSON(){}}var WQ=(Z,$,Q)=>{if(Z.doc??k(),$<0)$=Z._length+$;if(Q<0)Q=Z._length+Q;let J=Q-$,q=[],G=Z._start;while(G!==null&&J>0){if(G.countable&&!G.deleted){let K=G.content.getContent();if(K.length<=$)$-=K.length;else{for(let X=$;X<K.length&&J>0;X++)q.push(K[X]),J--;$=0}}G=G.right}return q},LQ=(Z)=>{Z.doc??k();let $=[],Q=Z._start;while(Q!==null){if(Q.countable&&!Q.deleted){let J=Q.content.getContent();for(let q=0;q<J.length;q++)$.push(J[q])}Q=Q.right}return $},v7=(Z,$)=>{let Q=[],J=Z._start;while(J!==null){if(J.countable&&NZ(J,$)){let q=J.content.getContent();for(let G=0;G<q.length;G++)Q.push(q[G])}J=J.right}return Q},A8=(Z,$)=>{let Q=0,J=Z._start;Z.doc??k();while(J!==null){if(J.countable&&!J.deleted){let q=J.content.getContent();for(let G=0;G<q.length;G++)$(q[G],Q++,Z)}J=J.right}},RQ=(Z,$)=>{let Q=[];return A8(Z,(J,q)=>{Q.push($(J,q,Z))}),Q},b7=(Z)=>{let $=Z._start,Q=null,J=0;return{[Symbol.iterator](){return this},next:()=>{if(Q===null){while($!==null&&$.deleted)$=$.right;if($===null)return{done:!0,value:void 0};Q=$.content.getContent(),J=0,$=$.right}let q=Q[J++];if(Q.length<=J)Q=null;return{done:!1,value:q}}}},YQ=(Z,$)=>{Z.doc??k();let Q=F$(Z,$),J=Z._start;if(Q!==null)J=Q.p,$-=Q.index;for(;J!==null;J=J.right)if(!J.deleted&&J.countable){if($<J.length)return J.content.getContent()[$];$-=J.length}},$$=(Z,$,Q,J)=>{let q=Q,G=Z.doc,K=G.clientID,X=G.store,B=Q===null?$._start:Q.right,F=[],_=()=>{if(F.length>0)q=new O(R(K,P(X,K)),q,q&&q.lastId,B,B&&B.id,$,null,new HZ(F)),q.integrate(Z,0),F=[]};J.forEach((H)=>{if(H===null)F.push(H);else switch(H.constructor){case Number:case Object:case Boolean:case Array:case String:F.push(H);break;default:switch(_(),H.constructor){case Uint8Array:case ArrayBuffer:q=new O(R(K,P(X,K)),q,q&&q.lastId,B,B&&B.id,$,null,new kZ(new Uint8Array(H))),q.integrate(Z,0);break;case jZ:q=new O(R(K,P(X,K)),q,q&&q.lastId,B,B&&B.id,$,null,new vZ(H)),q.integrate(Z,0);break;default:if(H instanceof x)q=new O(R(K,P(X,K)),q,q&&q.lastId,B,B&&B.id,$,null,new n(H)),q.integrate(Z,0);else throw new Error("Unexpected content type in insert operation")}}}),_()},OQ=()=>ZZ("Length exceeded!"),EQ=(Z,$,Q,J)=>{if(Q>$._length)throw OQ();if(Q===0){if($._searchMarker)T8($._searchMarker,Q,J.length);return $$(Z,$,null,J)}let q=Q,G=F$($,Q),K=$._start;if(G!==null){if(K=G.p,Q-=G.index,Q===0)K=K.prev,Q+=K&&K.countable&&!K.deleted?K.length:0}for(;K!==null;K=K.right)if(!K.deleted&&K.countable){if(Q<=K.length){if(Q<K.length)b(Z,R(K.id.client,K.id.clock+Q));break}Q-=K.length}if($._searchMarker)T8($._searchMarker,q,J.length);return $$(Z,$,K,J)},f7=(Z,$,Q)=>{let q=($._searchMarker||[]).reduce((G,K)=>K.index>G.index?K:G,{index:0,p:$._start}).p;if(q)while(q.right)q=q.right;return $$(Z,$,q,Q)},jQ=(Z,$,Q,J)=>{if(J===0)return;let q=Q,G=J,K=F$($,Q),X=$._start;if(K!==null)X=K.p,Q-=K.index;for(;X!==null&&Q>0;X=X.right)if(!X.deleted&&X.countable){if(Q<X.length)b(Z,R(X.id.client,X.id.clock+Q));Q-=X.length}while(J>0&&X!==null){if(!X.deleted){if(J<X.length)b(Z,R(X.id.client,X.id.clock+J));X.delete(Z),J-=X.length}X=X.right}if(J>0)throw OQ();if($._searchMarker)T8($._searchMarker,q,-G+J)},Q$=(Z,$,Q)=>{let J=$._map.get(Q);if(J!==void 0)J.delete(Z)},Y6=(Z,$,Q,J)=>{let q=$._map.get(Q)||null,G=Z.doc,K=G.clientID,X;if(J==null)X=new HZ([J]);else switch(J.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:X=new HZ([J]);break;case Uint8Array:X=new kZ(J);break;case jZ:X=new vZ(J);break;default:if(J instanceof x)X=new n(J);else throw new Error("Unexpected content type")}new O(R(K,P(G.store,K)),q,q&&q.lastId,null,null,$,Q,X).integrate(Z,0)},O6=(Z,$)=>{Z.doc??k();let Q=Z._map.get($);return Q!==void 0&&!Q.deleted?Q.content.getContent()[Q.length-1]:void 0},UQ=(Z)=>{let $={};return Z.doc??k(),Z._map.forEach((Q,J)=>{if(!Q.deleted)$[J]=Q.content.getContent()[Q.length-1]}),$},VQ=(Z,$)=>{Z.doc??k();let Q=Z._map.get($);return Q!==void 0&&!Q.deleted},g7=(Z,$,Q)=>{let J=Z._map.get($)||null;while(J!==null&&(!Q.sv.has(J.id.client)||J.id.clock>=(Q.sv.get(J.id.client)||0)))J=J.left;return J!==null&&NZ(J,Q)?J.content.getContent()[J.length-1]:void 0},PQ=(Z,$)=>{let Q={};return Z._map.forEach((J,q)=>{let G=J;while(G!==null&&(!$.sv.has(G.id.client)||G.id.clock>=($.sv.get(G.id.client)||0)))G=G.left;if(G!==null&&NZ(G,$))Q[q]=G.content.getContent()[G.length-1]}),Q},r8=(Z)=>{return Z.doc??k(),T4(Z._map.entries(),($)=>!$[1].deleted)};class E6 extends J8{}class BZ extends x{constructor(){super();this._prelimContent=[],this._searchMarker=[]}static from(Z){let $=new BZ;return $.push(Z),$}_integrate(Z,$){super._integrate(Z,$),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new BZ}clone(){let Z=new BZ;return Z.insert(0,this.toArray().map(($)=>$ instanceof x?$.clone():$)),Z}get length(){return this.doc??k(),this._length}_callObserver(Z,$){super._callObserver(Z,$),z$(this,Z,new E6(this,Z))}insert(Z,$){if(this.doc!==null)j(this.doc,(Q)=>{EQ(Q,this,Z,$)});else this._prelimContent.splice(Z,0,...$)}push(Z){if(this.doc!==null)j(this.doc,($)=>{f7($,this,Z)});else this._prelimContent.push(...Z)}unshift(Z){this.insert(0,Z)}delete(Z,$=1){if(this.doc!==null)j(this.doc,(Q)=>{jQ(Q,this,Z,$)});else this._prelimContent.splice(Z,$)}get(Z){return YQ(this,Z)}toArray(){return LQ(this)}slice(Z=0,$=this.length){return WQ(this,Z,$)}toJSON(){return this.map((Z)=>Z instanceof x?Z.toJSON():Z)}map(Z){return RQ(this,Z)}forEach(Z){A8(this,Z)}[Symbol.iterator](){return b7(this)}_write(Z){Z.writeTypeRef(GJ)}}var y7=(Z)=>new BZ;class j6 extends J8{constructor(Z,$,Q){super(Z,$);this.keysChanged=Q}}class YZ extends x{constructor(Z){super();if(this._prelimContent=null,Z===void 0)this._prelimContent=new Map;else this._prelimContent=new Map(Z)}_integrate(Z,$){super._integrate(Z,$),this._prelimContent.forEach((Q,J)=>{this.set(J,Q)}),this._prelimContent=null}_copy(){return new YZ}clone(){let Z=new YZ;return this.forEach(($,Q)=>{Z.set(Q,$ instanceof x?$.clone():$)}),Z}_callObserver(Z,$){z$(this,Z,new j6(this,Z,$))}toJSON(){this.doc??k();let Z={};return this._map.forEach(($,Q)=>{if(!$.deleted){let J=$.content.getContent()[$.length-1];Z[Q]=J instanceof x?J.toJSON():J}}),Z}get size(){return[...r8(this)].length}keys(){return a8(r8(this),(Z)=>Z[0])}values(){return a8(r8(this),(Z)=>Z[1].content.getContent()[Z[1].length-1])}entries(){return a8(r8(this),(Z)=>[Z[0],Z[1].content.getContent()[Z[1].length-1]])}forEach(Z){this.doc??k(),this._map.forEach(($,Q)=>{if(!$.deleted)Z($.content.getContent()[$.length-1],Q,this)})}[Symbol.iterator](){return this.entries()}delete(Z){if(this.doc!==null)j(this.doc,($)=>{Q$($,this,Z)});else this._prelimContent.delete(Z)}set(Z,$){if(this.doc!==null)j(this.doc,(Q)=>{Y6(Q,this,Z,$)});else this._prelimContent.set(Z,$);return $}get(Z){return O6(this,Z)}has(Z){return VQ(this,Z)}clear(){if(this.doc!==null)j(this.doc,(Z)=>{this.forEach(function($,Q,J){Q$(Z,J,Q)})});else this._prelimContent.clear()}_write(Z){Z.writeTypeRef(KJ)}}var m7=(Z)=>new YZ,LZ=(Z,$)=>Z===$||typeof Z==="object"&&typeof $==="object"&&Z&&$&&b$(Z,$);class J${constructor(Z,$,Q,J){this.left=Z,this.right=$,this.index=Q,this.currentAttributes=J}forward(){if(this.right===null)g();switch(this.right.content.constructor){case I:if(!this.right.deleted)q8(this.currentAttributes,this.right.content);break;default:if(!this.right.deleted)this.index+=this.right.length;break}this.left=this.right,this.right=this.right.right}}var f4=(Z,$,Q)=>{while($.right!==null&&Q>0){switch($.right.content.constructor){case I:if(!$.right.deleted)q8($.currentAttributes,$.right.content);break;default:if(!$.right.deleted){if(Q<$.right.length)b(Z,R($.right.id.client,$.right.id.clock+Q));$.index+=$.right.length,Q-=$.right.length}break}$.left=$.right,$.right=$.right.right}return $},t8=(Z,$,Q,J)=>{let q=new Map,G=J?F$($,Q):null;if(G){let K=new J$(G.p.left,G.p,G.index,q);return f4(Z,K,Q-G.index)}else{let K=new J$(null,$._start,0,q);return f4(Z,K,Q)}},TQ=(Z,$,Q,J)=>{while(Q.right!==null&&(Q.right.deleted===!0||Q.right.content.constructor===I&&LZ(J.get(Q.right.content.key),Q.right.content.value))){if(!Q.right.deleted)J.delete(Q.right.content.key);Q.forward()}let q=Z.doc,G=q.clientID;J.forEach((K,X)=>{let{left:B,right:F}=Q,_=new O(R(G,P(q.store,G)),B,B&&B.lastId,F,F&&F.id,$,null,new I(X,K));_.integrate(Z,0),Q.right=_,Q.forward()})},q8=(Z,$)=>{let{key:Q,value:J}=$;if(J===null)Z.delete(Q);else Z.set(Q,J)},AQ=(Z,$)=>{while(!0){if(Z.right===null)break;else if(Z.right.deleted||Z.right.content.constructor===I&&LZ($[Z.right.content.key]??null,Z.right.content.value));else break;Z.forward()}},wQ=(Z,$,Q,J)=>{let q=Z.doc,G=q.clientID,K=new Map;for(let X in J){let B=J[X],F=Q.currentAttributes.get(X)??null;if(!LZ(F,B)){K.set(X,F);let{left:_,right:H}=Q;Q.right=new O(R(G,P(q.store,G)),_,_&&_.lastId,H,H&&H.id,$,null,new I(X,B)),Q.right.integrate(Z,0),Q.forward()}}return K},a$=(Z,$,Q,J,q)=>{Q.currentAttributes.forEach((z,M)=>{if(q[M]===void 0)q[M]=null});let G=Z.doc,K=G.clientID;AQ(Q,q);let X=wQ(Z,$,Q,q),B=J.constructor===String?new a(J):J instanceof x?new n(J):new MZ(J),{left:F,right:_,index:H}=Q;if($._searchMarker)T8($._searchMarker,Q.index,B.getLength());_=new O(R(K,P(G.store,K)),F,F&&F.lastId,_,_&&_.id,$,null,B),_.integrate(Z,0),Q.right=_,Q.index=H,Q.forward(),TQ(Z,$,Q,X)},g4=(Z,$,Q,J,q)=>{let G=Z.doc,K=G.clientID;AQ(Q,q);let X=wQ(Z,$,Q,q);Z:while(Q.right!==null&&(J>0||X.size>0&&(Q.right.deleted||Q.right.content.constructor===I))){if(!Q.right.deleted)switch(Q.right.content.constructor){case I:{let{key:B,value:F}=Q.right.content,_=q[B];if(_!==void 0){if(LZ(_,F))X.delete(B);else{if(J===0)break Z;X.set(B,F)}Q.right.delete(Z)}else Q.currentAttributes.set(B,F);break}default:if(J<Q.right.length)b(Z,R(Q.right.id.client,Q.right.id.clock+J));J-=Q.right.length;break}Q.forward()}if(J>0){let B="";for(;J>0;J--)B+=`
`;Q.right=new O(R(K,P(G.store,K)),Q.left,Q.left&&Q.left.lastId,Q.right,Q.right&&Q.right.id,$,null,new a(B)),Q.right.integrate(Z,0),Q.forward()}TQ(Z,$,Q,X)},IQ=(Z,$,Q,J,q)=>{let G=$,K=T();while(G&&(!G.countable||G.deleted)){if(!G.deleted&&G.content.constructor===I){let F=G.content;K.set(F.key,F)}G=G.right}let X=0,B=!1;while($!==G){if(Q===$)B=!0;if(!$.deleted){let F=$.content;switch(F.constructor){case I:{let{key:_,value:H}=F,z=J.get(_)??null;if(K.get(_)!==F||z===H){if($.delete(Z),X++,!B&&(q.get(_)??null)===H&&z!==H)if(z===null)q.delete(_);else q.set(_,z)}if(!B&&!$.deleted)q8(q,F);break}}}$=$.right}return X},p7=(Z,$)=>{while($&&$.right&&($.right.deleted||!$.right.countable))$=$.right;let Q=new Set;while($&&($.deleted||!$.countable)){if(!$.deleted&&$.content.constructor===I){let J=$.content.key;if(Q.has(J))$.delete(Z);else Q.add(J)}$=$.left}},CQ=(Z)=>{let $=0;return j(Z.doc,(Q)=>{let{_start:J,_start:q}=Z,G=T(),K=h8(G);while(q){if(q.deleted===!1)switch(q.content.constructor){case I:q8(K,q.content);break;default:$+=IQ(Q,J,q,G,K),G=h8(K),J=q;break}q=q.right}}),$},u7=(Z)=>{let $=new Set,Q=Z.doc;for(let[J,q]of Z.afterState.entries()){let G=Z.beforeState.get(J)||0;if(q===G)continue;t4(Z,Q.store.clients.get(J),G,q,(K)=>{if(!K.deleted&&K.content.constructor===I&&K.constructor!==y)$.add(K.parent)})}j(Q,(J)=>{wZ(Z,Z.deleteSet,(q)=>{if(q instanceof y||!q.parent._hasFormatting||$.has(q.parent))return;let G=q.parent;if(q.content.constructor===I)$.add(G);else p7(J,q)});for(let q of $)CQ(q)})},y4=(Z,$,Q)=>{let J=Q,q=h8($.currentAttributes),G=$.right;while(Q>0&&$.right!==null){if($.right.deleted===!1)switch($.right.content.constructor){case n:case MZ:case a:if(Q<$.right.length)b(Z,R($.right.id.client,$.right.id.clock+Q));Q-=$.right.length,$.right.delete(Z);break}$.forward()}if(G)IQ(Z,G,$.right,q,$.currentAttributes);let K=($.left||$.right).parent;if(K._searchMarker)T8(K._searchMarker,$.index,-J+Q);return $};class U6 extends J8{constructor(Z,$,Q){super(Z,$);this.childListChanged=!1,this.keysChanged=new Set,Q.forEach((J)=>{if(J===null)this.childListChanged=!0;else this.keysChanged.add(J)})}get changes(){if(this._changes===null){let Z={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=Z}return this._changes}get delta(){if(this._delta===null){let Z=this.target.doc,$=[];j(Z,(Q)=>{let J=new Map,q=new Map,G=this.target._start,K=null,X={},B="",F=0,_=0,H=()=>{if(K!==null){let z=null;switch(K){case"delete":if(_>0)z={delete:_};_=0;break;case"insert":if(typeof B==="object"||B.length>0){if(z={insert:B},J.size>0)z.attributes={},J.forEach((M,N)=>{if(M!==null)z.attributes[N]=M})}B="";break;case"retain":if(F>0){if(z={retain:F},!_4(X))z.attributes=G4({},X)}F=0;break}if(z)$.push(z);K=null}};while(G!==null){switch(G.content.constructor){case n:case MZ:if(this.adds(G)){if(!this.deletes(G))H(),K="insert",B=G.content.getContent()[0],H()}else if(this.deletes(G)){if(K!=="delete")H(),K="delete";_+=1}else if(!G.deleted){if(K!=="retain")H(),K="retain";F+=1}break;case a:if(this.adds(G)){if(!this.deletes(G)){if(K!=="insert")H(),K="insert";B+=G.content.str}}else if(this.deletes(G)){if(K!=="delete")H(),K="delete";_+=G.length}else if(!G.deleted){if(K!=="retain")H(),K="retain";F+=G.length}break;case I:{let{key:z,value:M}=G.content;if(this.adds(G)){if(!this.deletes(G)){let N=J.get(z)??null;if(!LZ(N,M)){if(K==="retain")H();if(LZ(M,q.get(z)??null))delete X[z];else X[z]=M}else if(M!==null)G.delete(Q)}}else if(this.deletes(G)){q.set(z,M);let N=J.get(z)??null;if(!LZ(N,M)){if(K==="retain")H();X[z]=N}}else if(!G.deleted){q.set(z,M);let N=X[z];if(N!==void 0){if(!LZ(N,M)){if(K==="retain")H();if(M===null)delete X[z];else X[z]=M}else if(N!==null)G.delete(Q)}}if(!G.deleted){if(K==="insert")H();q8(J,G.content)}break}}G=G.right}H();while($.length>0){let z=$[$.length-1];if(z.retain!==void 0&&z.attributes===void 0)$.pop();else break}}),this._delta=$}return this._delta}}class xZ extends x{constructor(Z){super();this._pending=Z!==void 0?[()=>this.insert(0,Z)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??k(),this._length}_integrate(Z,$){super._integrate(Z,$);try{this._pending.forEach((Q)=>Q())}catch(Q){console.error(Q)}this._pending=null}_copy(){return new xZ}clone(){let Z=new xZ;return Z.applyDelta(this.toDelta()),Z}_callObserver(Z,$){super._callObserver(Z,$);let Q=new U6(this,Z,$);if(z$(this,Z,Q),!Z.local&&this._hasFormatting)Z._needFormattingCleanup=!0}toString(){this.doc??k();let Z="",$=this._start;while($!==null){if(!$.deleted&&$.countable&&$.content.constructor===a)Z+=$.content.str;$=$.right}return Z}toJSON(){return this.toString()}applyDelta(Z,{sanitize:$=!0}={}){if(this.doc!==null)j(this.doc,(Q)=>{let J=new J$(null,this._start,0,new Map);for(let q=0;q<Z.length;q++){let G=Z[q];if(G.insert!==void 0){let K=!$&&typeof G.insert==="string"&&q===Z.length-1&&J.right===null&&G.insert.slice(-1)===`
`?G.insert.slice(0,-1):G.insert;if(typeof K!=="string"||K.length>0)a$(Q,this,J,K,G.attributes||{})}else if(G.retain!==void 0)g4(Q,this,J,G.retain,G.attributes||{});else if(G.delete!==void 0)y4(Q,J,G.delete)}});else this._pending.push(()=>this.applyDelta(Z))}toDelta(Z,$,Q){this.doc??k();let J=[],q=new Map,G=this.doc,K="",X=this._start;function B(){if(K.length>0){let _={},H=!1;q.forEach((M,N)=>{H=!0,_[N]=M});let z={insert:K};if(H)z.attributes=_;J.push(z),K=""}}let F=()=>{while(X!==null){if(NZ(X,Z)||$!==void 0&&NZ(X,$))switch(X.content.constructor){case a:{let _=q.get("ychange");if(Z!==void 0&&!NZ(X,Z)){if(_===void 0||_.user!==X.id.client||_.type!=="removed")B(),q.set("ychange",Q?Q("removed",X.id):{type:"removed"})}else if($!==void 0&&!NZ(X,$)){if(_===void 0||_.user!==X.id.client||_.type!=="added")B(),q.set("ychange",Q?Q("added",X.id):{type:"added"})}else if(_!==void 0)B(),q.delete("ychange");K+=X.content.str;break}case n:case MZ:{B();let _={insert:X.content.getContent()[0]};if(q.size>0){let H={};_.attributes=H,q.forEach((z,M)=>{H[M]=z})}J.push(_);break}case I:if(NZ(X,Z))B(),q8(q,X.content);break}X=X.right}B()};if(Z||$)j(G,(_)=>{if(Z)n$(_,Z);if($)n$(_,$);F()},"cleanup");else F();return J}insert(Z,$,Q){if($.length<=0)return;let J=this.doc;if(J!==null)j(J,(q)=>{let G=t8(q,this,Z,!Q);if(!Q)Q={},G.currentAttributes.forEach((K,X)=>{Q[X]=K});a$(q,this,G,$,Q)});else this._pending.push(()=>this.insert(Z,$,Q))}insertEmbed(Z,$,Q){let J=this.doc;if(J!==null)j(J,(q)=>{let G=t8(q,this,Z,!Q);a$(q,this,G,$,Q||{})});else this._pending.push(()=>this.insertEmbed(Z,$,Q||{}))}delete(Z,$){if($===0)return;let Q=this.doc;if(Q!==null)j(Q,(J)=>{y4(J,t8(J,this,Z,!0),$)});else this._pending.push(()=>this.delete(Z,$))}format(Z,$,Q){if($===0)return;let J=this.doc;if(J!==null)j(J,(q)=>{let G=t8(q,this,Z,!1);if(G.right===null)return;g4(q,this,G,$,Q)});else this._pending.push(()=>this.format(Z,$,Q))}removeAttribute(Z){if(this.doc!==null)j(this.doc,($)=>{Q$($,this,Z)});else this._pending.push(()=>this.removeAttribute(Z))}setAttribute(Z,$){if(this.doc!==null)j(this.doc,(Q)=>{Y6(Q,this,Z,$)});else this._pending.push(()=>this.setAttribute(Z,$))}getAttribute(Z){return O6(this,Z)}getAttributes(){return UQ(this)}_write(Z){Z.writeTypeRef(XJ)}}var l7=(Z)=>new xZ;class Z${constructor(Z,$=()=>!0){this._filter=$,this._root=Z,this._currentNode=Z._start,this._firstCall=!0,Z.doc??k()}[Symbol.iterator](){return this}next(){let Z=this._currentNode,$=Z&&Z.content&&Z.content.type;if(Z!==null&&(!this._firstCall||Z.deleted||!this._filter($)))do if($=Z.content.type,!Z.deleted&&($.constructor===EZ||$.constructor===OZ)&&$._start!==null)Z=$._start;else while(Z!==null){let Q=Z.next;if(Q!==null){Z=Q;break}else if(Z.parent===this._root)Z=null;else Z=Z.parent._item}while(Z!==null&&(Z.deleted||!this._filter(Z.content.type)));if(this._firstCall=!1,Z===null)return{value:void 0,done:!0};return this._currentNode=Z,{value:Z.content.type,done:!1}}}class OZ extends x{constructor(){super();this._prelimContent=[]}get firstChild(){let Z=this._first;return Z?Z.content.getContent()[0]:null}_integrate(Z,$){super._integrate(Z,$),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new OZ}clone(){let Z=new OZ;return Z.insert(0,this.toArray().map(($)=>$ instanceof x?$.clone():$)),Z}get length(){return this.doc??k(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(Z){return new Z$(this,Z)}querySelector(Z){Z=Z.toUpperCase();let Q=new Z$(this,(J)=>J.nodeName&&J.nodeName.toUpperCase()===Z).next();if(Q.done)return null;else return Q.value}querySelectorAll(Z){return Z=Z.toUpperCase(),r(new Z$(this,($)=>$.nodeName&&$.nodeName.toUpperCase()===Z))}_callObserver(Z,$){z$(this,Z,new V6(this,$,Z))}toString(){return RQ(this,(Z)=>Z.toString()).join("")}toJSON(){return this.toString()}toDOM(Z=document,$={},Q){let J=Z.createDocumentFragment();if(Q!==void 0)Q._createAssociation(J,this);return A8(this,(q)=>{J.insertBefore(q.toDOM(Z,$,Q),null)}),J}insert(Z,$){if(this.doc!==null)j(this.doc,(Q)=>{EQ(Q,this,Z,$)});else this._prelimContent.splice(Z,0,...$)}insertAfter(Z,$){if(this.doc!==null)j(this.doc,(Q)=>{let J=Z&&Z instanceof x?Z._item:Z;$$(Q,this,J,$)});else{let Q=this._prelimContent,J=Z===null?0:Q.findIndex((q)=>q===Z)+1;if(J===0&&Z!==null)throw ZZ("Reference item not found");Q.splice(J,0,...$)}}delete(Z,$=1){if(this.doc!==null)j(this.doc,(Q)=>{jQ(Q,this,Z,$)});else this._prelimContent.splice(Z,$)}toArray(){return LQ(this)}push(Z){this.insert(this.length,Z)}unshift(Z){this.insert(0,Z)}get(Z){return YQ(this,Z)}slice(Z=0,$=this.length){return WQ(this,Z,$)}forEach(Z){A8(this,Z)}_write(Z){Z.writeTypeRef(_J)}}var i7=(Z)=>new OZ;class EZ extends OZ{constructor(Z="UNDEFINED"){super();this.nodeName=Z,this._prelimAttrs=new Map}get nextSibling(){let Z=this._item?this._item.next:null;return Z?Z.content.type:null}get prevSibling(){let Z=this._item?this._item.prev:null;return Z?Z.content.type:null}_integrate(Z,$){super._integrate(Z,$),this._prelimAttrs.forEach((Q,J)=>{this.setAttribute(J,Q)}),this._prelimAttrs=null}_copy(){return new EZ(this.nodeName)}clone(){let Z=new EZ(this.nodeName),$=this.getAttributes();return X4($,(Q,J)=>{if(typeof Q==="string")Z.setAttribute(J,Q)}),Z.insert(0,this.toArray().map((Q)=>Q instanceof x?Q.clone():Q)),Z}toString(){let Z=this.getAttributes(),$=[],Q=[];for(let K in Z)Q.push(K);Q.sort();let J=Q.length;for(let K=0;K<J;K++){let X=Q[K];$.push(X+'="'+Z[X]+'"')}let q=this.nodeName.toLocaleLowerCase(),G=$.length>0?" "+$.join(" "):"";return`<${q}${G}>${super.toString()}</${q}>`}removeAttribute(Z){if(this.doc!==null)j(this.doc,($)=>{Q$($,this,Z)});else this._prelimAttrs.delete(Z)}setAttribute(Z,$){if(this.doc!==null)j(this.doc,(Q)=>{Y6(Q,this,Z,$)});else this._prelimAttrs.set(Z,$)}getAttribute(Z){return O6(this,Z)}hasAttribute(Z){return VQ(this,Z)}getAttributes(Z){return Z?PQ(this,Z):UQ(this)}toDOM(Z=document,$={},Q){let J=Z.createElement(this.nodeName),q=this.getAttributes();for(let G in q){let K=q[G];if(typeof K==="string")J.setAttribute(G,K)}if(A8(this,(G)=>{J.appendChild(G.toDOM(Z,$,Q))}),Q!==void 0)Q._createAssociation(J,this);return J}_write(Z){Z.writeTypeRef(BJ),Z.writeKey(this.nodeName)}}var d7=(Z)=>new EZ(Z.readKey());class V6 extends J8{constructor(Z,$,Q){super(Z,Q);this.childListChanged=!1,this.attributesChanged=new Set,$.forEach((J)=>{if(J===null)this.childListChanged=!0;else this.attributesChanged.add(J)})}}class $8 extends YZ{constructor(Z){super();this.hookName=Z}_copy(){return new $8(this.hookName)}clone(){let Z=new $8(this.hookName);return this.forEach(($,Q)=>{Z.set(Q,$)}),Z}toDOM(Z=document,$={},Q){let J=$[this.hookName],q;if(J!==void 0)q=J.createDom(this);else q=document.createElement(this.hookName);if(q.setAttribute("data-yjs-hook",this.hookName),Q!==void 0)Q._createAssociation(q,this);return q}_write(Z){Z.writeTypeRef(HJ),Z.writeKey(this.hookName)}}var s7=(Z)=>new $8(Z.readKey());class w8 extends xZ{get nextSibling(){let Z=this._item?this._item.next:null;return Z?Z.content.type:null}get prevSibling(){let Z=this._item?this._item.prev:null;return Z?Z.content.type:null}_copy(){return new w8}clone(){let Z=new w8;return Z.applyDelta(this.toDelta()),Z}toDOM(Z=document,$,Q){let J=Z.createTextNode(this.toString());if(Q!==void 0)Q._createAssociation(J,this);return J}toString(){return this.toDelta().map((Z)=>{let $=[];for(let J in Z.attributes){let q=[];for(let G in Z.attributes[J])q.push({key:G,value:Z.attributes[J][G]});q.sort((G,K)=>G.key<K.key?-1:1),$.push({nodeName:J,attrs:q})}$.sort((J,q)=>J.nodeName<q.nodeName?-1:1);let Q="";for(let J=0;J<$.length;J++){let q=$[J];Q+=`<${q.nodeName}`;for(let G=0;G<q.attrs.length;G++){let K=q.attrs[G];Q+=` ${K.key}="${K.value}"`}Q+=">"}Q+=Z.insert;for(let J=$.length-1;J>=0;J--)Q+=`</${$[J].nodeName}>`;return Q}).join("")}toJSON(){return this.toString()}_write(Z){Z.writeTypeRef(FJ)}}var c7=(Z)=>new w8;class D8{constructor(Z,$){this.id=Z,this.length=$}get deleted(){throw t()}mergeWith(Z){return!1}write(Z,$,Q){throw t()}integrate(Z,$){throw t()}}var o7=0;class y extends D8{get deleted(){return!0}delete(){}mergeWith(Z){if(this.constructor!==Z.constructor)return!1;return this.length+=Z.length,!0}integrate(Z,$){if($>0)this.id.clock+=$,this.length-=$;r4(Z.doc.store,this)}write(Z,$){Z.writeInfo(o7),Z.writeLen(this.length-$)}getMissing(Z,$){return null}}class kZ{constructor(Z){this.content=Z}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new kZ(this.content)}splice(Z){throw t()}mergeWith(Z){return!1}integrate(Z,$){}delete(Z){}gc(Z){}write(Z,$){Z.writeBuf(this.content)}getRef(){return 3}}var a7=(Z)=>new kZ(Z.readBuf());class DZ{constructor(Z){this.len=Z}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new DZ(this.len)}splice(Z){let $=new DZ(this.len-Z);return this.len=Z,$}mergeWith(Z){return this.len+=Z.len,!0}integrate(Z,$){U8(Z.deleteSet,$.id.client,$.id.clock,this.len),$.markDeleted()}delete(Z){}gc(Z){}write(Z,$){Z.writeLen(this.len-$)}getRef(){return 1}}var n7=(Z)=>new DZ(Z.readLen()),xQ=(Z,$)=>new jZ({guid:Z,...$,shouldLoad:$.shouldLoad||$.autoLoad||!1});class vZ{constructor(Z){if(Z._item)console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid.");this.doc=Z;let $={};if(this.opts=$,!Z.gc)$.gc=!1;if(Z.autoLoad)$.autoLoad=!0;if(Z.meta!==null)$.meta=Z.meta}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new vZ(xQ(this.doc.guid,this.opts))}splice(Z){throw t()}mergeWith(Z){return!1}integrate(Z,$){if(this.doc._item=$,Z.subdocsAdded.add(this.doc),this.doc.shouldLoad)Z.subdocsLoaded.add(this.doc)}delete(Z){if(Z.subdocsAdded.has(this.doc))Z.subdocsAdded.delete(this.doc);else Z.subdocsRemoved.add(this.doc)}gc(Z){}write(Z,$){Z.writeString(this.doc.guid),Z.writeAny(this.opts)}getRef(){return 9}}var r7=(Z)=>new vZ(xQ(Z.readString(),Z.readAny()));class MZ{constructor(Z){this.embed=Z}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new MZ(this.embed)}splice(Z){throw t()}mergeWith(Z){return!1}integrate(Z,$){}delete(Z){}gc(Z){}write(Z,$){Z.writeJSON(this.embed)}getRef(){return 5}}var t7=(Z)=>new MZ(Z.readJSON());class I{constructor(Z,$){this.key=Z,this.value=$}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new I(this.key,this.value)}splice(Z){throw t()}mergeWith(Z){return!1}integrate(Z,$){let Q=$.parent;Q._searchMarker=null,Q._hasFormatting=!0}delete(Z){}gc(Z){}write(Z,$){Z.writeKey(this.key),Z.writeJSON(this.value)}getRef(){return 6}}var e7=(Z)=>new I(Z.readKey(),Z.readJSON());class Q8{constructor(Z){this.arr=Z}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Q8(this.arr)}splice(Z){let $=new Q8(this.arr.slice(Z));return this.arr=this.arr.slice(0,Z),$}mergeWith(Z){return this.arr=this.arr.concat(Z.arr),!0}integrate(Z,$){}delete(Z){}gc(Z){}write(Z,$){let Q=this.arr.length;Z.writeLen(Q-$);for(let J=$;J<Q;J++){let q=this.arr[J];Z.writeString(q===void 0?"undefined":JSON.stringify(q))}}getRef(){return 2}}var ZJ=(Z)=>{let $=Z.readLen(),Q=[];for(let J=0;J<$;J++){let q=Z.readString();if(q==="undefined")Q.push(void 0);else Q.push(JSON.parse(q))}return new Q8(Q)},$J=Y8("node_env")==="development";class HZ{constructor(Z){this.arr=Z,$J&&f$(Z)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new HZ(this.arr)}splice(Z){let $=new HZ(this.arr.slice(Z));return this.arr=this.arr.slice(0,Z),$}mergeWith(Z){return this.arr=this.arr.concat(Z.arr),!0}integrate(Z,$){}delete(Z){}gc(Z){}write(Z,$){let Q=this.arr.length;Z.writeLen(Q-$);for(let J=$;J<Q;J++){let q=this.arr[J];Z.writeAny(q)}}getRef(){return 8}}var QJ=(Z)=>{let $=Z.readLen(),Q=[];for(let J=0;J<$;J++)Q.push(Z.readAny());return new HZ(Q)};class a{constructor(Z){this.str=Z}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new a(this.str)}splice(Z){let $=new a(this.str.slice(Z));this.str=this.str.slice(0,Z);let Q=this.str.charCodeAt(Z-1);if(Q>=55296&&Q<=56319)this.str=this.str.slice(0,Z-1)+"",$.str=""+$.str.slice(1);return $}mergeWith(Z){return this.str+=Z.str,!0}integrate(Z,$){}delete(Z){}gc(Z){}write(Z,$){Z.writeString($===0?this.str:this.str.slice($))}getRef(){return 4}}var JJ=(Z)=>new a(Z.readString()),qJ=[y7,m7,l7,d7,i7,s7,c7],GJ=0,KJ=1,XJ=2,BJ=3,_J=4,HJ=5,FJ=6;class n{constructor(Z){this.type=Z}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new n(this.type._copy())}splice(Z){throw t()}mergeWith(Z){return!1}integrate(Z,$){this.type._integrate(Z.doc,$)}delete(Z){let $=this.type._start;while($!==null){if(!$.deleted)$.delete(Z);else if($.id.clock<(Z.beforeState.get($.id.client)||0))Z._mergeStructs.push($);$=$.right}this.type._map.forEach((Q)=>{if(!Q.deleted)Q.delete(Z);else if(Q.id.clock<(Z.beforeState.get(Q.id.client)||0))Z._mergeStructs.push(Q)}),Z.changed.delete(this.type)}gc(Z){let $=this.type._start;while($!==null)$.gc(Z,!0),$=$.right;this.type._start=null,this.type._map.forEach((Q)=>{while(Q!==null)Q.gc(Z,!0),Q=Q.left}),this.type._map=new Map}write(Z,$){this.type._write(Z)}getRef(){return 7}}var zJ=(Z)=>new n(qJ[Z.readTypeRef()](Z)),e$=(Z,$)=>{let Q=$,J=0,q;do{if(J>0)Q=R(Q.client,Q.clock+J);q=AZ(Z,Q),J=Q.clock-q.id.clock,Q=q.redone}while(Q!==null&&q instanceof O);return{item:q,diff:J}},P6=(Z,$)=>{while(Z!==null&&Z.keep!==$)Z.keep=$,Z=Z.parent._item},q$=(Z,$,Q)=>{let{client:J,clock:q}=$.id,G=new O(R(J,q+Q),$,R(J,q+Q-1),$.right,$.rightOrigin,$.parent,$.parentSub,$.content.splice(Q));if($.deleted)G.markDeleted();if($.keep)G.keep=!0;if($.redone!==null)G.redone=R($.redone.client,$.redone.clock+Q);if($.right=G,G.right!==null)G.right.left=G;if(Z._mergeStructs.push(G),G.parentSub!==null&&G.right===null)G.parent._map.set(G.parentSub,G);return $.length=Q,G},m4=(Z,$)=>b6(Z,(Q)=>hZ(Q.deletions,$)),DQ=(Z,$,Q,J,q,G)=>{let K=Z.doc,X=K.store,B=K.clientID,F=$.redone;if(F!==null)return b(Z,F);let _=$.parent._item,H=null,z;if(_!==null&&_.deleted===!0){if(_.redone===null&&(!Q.has(_)||DQ(Z,_,Q,J,q,G)===null))return null;while(_.redone!==null)_=b(Z,_.redone)}let M=_===null?$.parent:_.content.type;if($.parentSub===null){H=$.left,z=$;while(H!==null){let C=H;while(C!==null&&C.parent._item!==_)C=C.redone===null?null:b(Z,C.redone);if(C!==null&&C.parent._item===_){H=C;break}H=H.left}while(z!==null){let C=z;while(C!==null&&C.parent._item!==_)C=C.redone===null?null:b(Z,C.redone);if(C!==null&&C.parent._item===_){z=C;break}z=z.right}}else if(z=null,$.right&&!q){H=$;while(H!==null&&H.right!==null&&(H.right.redone||hZ(J,H.right.id)||m4(G.undoStack,H.right.id)||m4(G.redoStack,H.right.id))){H=H.right;while(H.redone)H=b(Z,H.redone)}if(H&&H.right!==null)return null}else H=M._map.get($.parentSub)||null;let N=P(X,B),Y=R(B,N),V=new O(Y,H,H&&H.lastId,z,z&&z.id,M,$.parentSub,$.content.copy());return $.redone=Y,P6(V,!0),V.integrate(Z,0),V};class O extends D8{constructor(Z,$,Q,J,q,G,K,X){super(Z,X.getLength());this.origin=Q,this.left=$,this.right=J,this.rightOrigin=q,this.parent=G,this.parentSub=K,this.redone=null,this.content=X,this.info=this.content.isCountable()?O$:0}set marker(Z){if((this.info&y8)>0!==Z)this.info^=y8}get marker(){return(this.info&y8)>0}get keep(){return(this.info&Y$)>0}set keep(Z){if(this.keep!==Z)this.info^=Y$}get countable(){return(this.info&O$)>0}get deleted(){return(this.info&g8)>0}set deleted(Z){if(this.deleted!==Z)this.info^=g8}markDeleted(){this.info|=g8}getMissing(Z,$){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=P($,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=P($,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===RZ&&this.id.client!==this.parent.client&&this.parent.clock>=P($,this.parent.client))return this.parent.client;if(this.origin)this.left=t$(Z,$,this.origin),this.origin=this.left.lastId;if(this.rightOrigin)this.right=b(Z,this.rightOrigin),this.rightOrigin=this.right.id;if(this.left&&this.left.constructor===y||this.right&&this.right.constructor===y)this.parent=null;else if(!this.parent){if(this.left&&this.left.constructor===O)this.parent=this.left.parent,this.parentSub=this.left.parentSub;else if(this.right&&this.right.constructor===O)this.parent=this.right.parent,this.parentSub=this.right.parentSub}else if(this.parent.constructor===RZ){let Q=AZ($,this.parent);if(Q.constructor===y)this.parent=null;else this.parent=Q.content.type}return null}integrate(Z,$){if($>0)this.id.clock+=$,this.left=t$(Z,Z.doc.store,R(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice($),this.length-=$;if(this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let Q=this.left,J;if(Q!==null)J=Q.right;else if(this.parentSub!==null){J=this.parent._map.get(this.parentSub)||null;while(J!==null&&J.left!==null)J=J.left}else J=this.parent._start;let q=new Set,G=new Set;while(J!==null&&J!==this.right){if(G.add(J),q.add(J),TZ(this.origin,J.origin)){if(J.id.client<this.id.client)Q=J,q.clear();else if(TZ(this.rightOrigin,J.rightOrigin))break}else if(J.origin!==null&&G.has(AZ(Z.doc.store,J.origin))){if(!q.has(AZ(Z.doc.store,J.origin)))Q=J,q.clear()}else break;J=J.right}this.left=Q}if(this.left!==null){let Q=this.left.right;this.right=Q,this.left.right=this}else{let Q;if(this.parentSub!==null){Q=this.parent._map.get(this.parentSub)||null;while(Q!==null&&Q.left!==null)Q=Q.left}else Q=this.parent._start,this.parent._start=this;this.right=Q}if(this.right!==null)this.right.left=this;else if(this.parentSub!==null){if(this.parent._map.set(this.parentSub,this),this.left!==null)this.left.delete(Z)}if(this.parentSub===null&&this.countable&&!this.deleted)this.parent._length+=this.length;if(r4(Z.doc.store,this),this.content.integrate(Z,this),h4(Z,this.parent,this.parentSub),this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)this.delete(Z)}else new y(this.id,this.length).integrate(Z,0)}get next(){let Z=this.right;while(Z!==null&&Z.deleted)Z=Z.right;return Z}get prev(){let Z=this.left;while(Z!==null&&Z.deleted)Z=Z.left;return Z}get lastId(){return this.length===1?this.id:R(this.id.client,this.id.clock+this.length-1)}mergeWith(Z){if(this.constructor===Z.constructor&&TZ(Z.origin,this.lastId)&&this.right===Z&&TZ(this.rightOrigin,Z.rightOrigin)&&this.id.client===Z.id.client&&this.id.clock+this.length===Z.id.clock&&this.deleted===Z.deleted&&this.redone===null&&Z.redone===null&&this.content.constructor===Z.content.constructor&&this.content.mergeWith(Z.content)){let $=this.parent._searchMarker;if($)$.forEach((Q)=>{if(Q.p===Z){if(Q.p=this,!this.deleted&&this.countable)Q.index-=this.length}});if(Z.keep)this.keep=!0;if(this.right=Z.right,this.right!==null)this.right.left=this;return this.length+=Z.length,!0}return!1}delete(Z){if(!this.deleted){let $=this.parent;if(this.countable&&this.parentSub===null)$._length-=this.length;this.markDeleted(),U8(Z.deleteSet,this.id.client,this.id.clock,this.length),h4(Z,$,this.parentSub),this.content.delete(Z)}}gc(Z,$){if(!this.deleted)throw g();if(this.content.gc(Z),$)O7(Z,this,new y(this.id,this.length));else this.content=new DZ(this.length)}write(Z,$){let Q=$>0?R(this.id.client,this.id.clock+$-1):this.origin,J=this.rightOrigin,q=this.parentSub,G=this.content.getRef()&B8|(Q===null?0:v)|(J===null?0:d)|(q===null?0:uZ);if(Z.writeInfo(G),Q!==null)Z.writeLeftID(Q);if(J!==null)Z.writeRightID(J);if(Q===null&&J===null){let K=this.parent;if(K._item!==void 0){let X=K._item;if(X===null){let B=H6(K);Z.writeParentInfo(!0),Z.writeString(B)}else Z.writeParentInfo(!1),Z.writeLeftID(X.id)}else if(K.constructor===String)Z.writeParentInfo(!0),Z.writeString(K);else if(K.constructor===RZ)Z.writeParentInfo(!1),Z.writeLeftID(K);else g();if(q!==null)Z.writeString(q)}this.content.write(Z,$)}}var SQ=(Z,$)=>MJ[$&B8](Z),MJ=[()=>{g()},n7,ZJ,a7,JJ,t7,e7,zJ,QJ,r7,()=>{g()}],NJ=10;class f extends D8{get deleted(){return!0}delete(){}mergeWith(Z){if(this.constructor!==Z.constructor)return!1;return this.length+=Z.length,!0}integrate(Z,$){g()}write(Z,$){Z.writeInfo(NJ),W(Z.restEncoder,this.length-$)}getMissing(Z,$){return null}}var hQ=typeof globalThis!=="undefined"?globalThis:typeof window!=="undefined"?window:typeof global!=="undefined"?global:{},kQ="__ $YJS$ __";if(hQ[kQ]===!0)console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");hQ[kQ]=!0;var vQ=new Map;class bQ{constructor(Z){this.room=Z,this.onmessage=null,this._onChange=($)=>$.key===Z&&this.onmessage!==null&&this.onmessage({data:L4($.newValue||"")}),$4(this._onChange)}postMessage(Z){d8.setItem(this.room,W4(N4(Z)))}close(){Q4(this._onChange)}}var WJ=typeof BroadcastChannel==="undefined"?bQ:BroadcastChannel,T6=(Z)=>S(vQ,Z,()=>{let $=i(),Q=new WJ(Z);return Q.onmessage=(J)=>$.forEach((q)=>q(J.data,"broadcastchannel")),{bc:Q,subs:$}}),fQ=(Z,$)=>{return T6(Z).subs.add($),$},gQ=(Z,$)=>{let Q=T6(Z),J=Q.subs.delete($);if(J&&Q.subs.size===0)Q.bc.close(),vQ.delete(Z);return J},bZ=(Z,$,Q=null)=>{let J=T6(Z);J.bc.postMessage($),J.subs.forEach((q)=>q($,Q))};var yQ=0,N$=1,mQ=2,W$=(Z,$)=>{W(Z,yQ);let Q=_6($);U(Z,Q)},A6=(Z,$,Q)=>{W(Z,N$),U(Z,K6($,Q))},RJ=(Z,$,Q)=>A6($,Q,D(Z)),pQ=(Z,$,Q)=>{try{G6($,D(Z),Q)}catch(J){console.error("Caught error while handling a Yjs update",J)}},uQ=(Z,$)=>{W(Z,mQ),U(Z,$)},YJ=pQ,lQ=(Z,$,Q,J)=>{let q=L(Z);switch(q){case yQ:RJ(Z,$,Q);break;case N$:pQ(Z,Q,J);break;case mQ:YJ(Z,Q,J);break;default:throw new Error("Unknown message type")}return q};var EJ=0;var iQ=(Z,$,Q)=>{switch(L(Z)){case EJ:Q($,s(Z))}};var w6=30000;class I6 extends R${constructor(Z){super();this.doc=Z,this.clientID=Z.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let $=u();if(this.getLocalState()!==null&&w6/2<=$-this.meta.get(this.clientID).lastUpdated)this.setLocalState(this.getLocalState());let Q=[];if(this.meta.forEach((J,q)=>{if(q!==this.clientID&&w6<=$-J.lastUpdated&&this.states.has(q))Q.push(q)}),Q.length>0)L$(this,Q,"timeout")},m(w6/10)),Z.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(Z){let $=this.clientID,Q=this.meta.get($),J=Q===void 0?0:Q.clock+1,q=this.states.get($);if(Z===null)this.states.delete($);else this.states.set($,Z);this.meta.set($,{clock:J,lastUpdated:u()});let G=[],K=[],X=[],B=[];if(Z===null)B.push($);else if(q==null){if(Z!=null)G.push($)}else if(K.push($),!tZ(q,Z))X.push($);if(G.length>0||X.length>0||B.length>0)this.emit("change",[{added:G,updated:X,removed:B},"local"]);this.emit("update",[{added:G,updated:K,removed:B},"local"])}setLocalStateField(Z,$){let Q=this.getLocalState();if(Q!==null)this.setLocalState({...Q,[Z]:$})}getStates(){return this.states}}var L$=(Z,$,Q)=>{let J=[];for(let q=0;q<$.length;q++){let G=$[q];if(Z.states.has(G)){if(Z.states.delete(G),G===Z.clientID){let K=Z.meta.get(G);Z.meta.set(G,{clock:K.clock+1,lastUpdated:u()})}J.push(G)}}if(J.length>0)Z.emit("change",[{added:[],updated:[],removed:J},Q]),Z.emit("update",[{added:[],updated:[],removed:J},Q])},G8=(Z,$,Q=Z.states)=>{let J=$.length,q=A();W(q,J);for(let G=0;G<J;G++){let K=$[G],X=Q.get(K)||null,B=Z.meta.get(K).clock;W(q,K),W(q,B),e(q,JSON.stringify(X))}return E(q)};var dQ=(Z,$,Q)=>{let J=w($),q=u(),G=[],K=[],X=[],B=[],F=L(J);for(let _=0;_<F;_++){let H=L(J),z=L(J),M=JSON.parse(s(J)),N=Z.meta.get(H),Y=Z.states.get(H),V=N===void 0?0:N.clock;if(V<z||V===z&&M===null&&Z.states.has(H)){if(M===null)if(H===Z.clientID&&Z.getLocalState()!=null)z++;else Z.states.delete(H);else Z.states.set(H,M);if(Z.meta.set(H,{clock:z,lastUpdated:q}),N===void 0&&M!==null)G.push(H);else if(N!==void 0&&M===null)B.push(H);else if(M!==null){if(!tZ(M,Y))X.push(H);K.push(H)}}}if(G.length>0||X.length>0||B.length>0)Z.emit("change",[{added:G,updated:X,removed:B},Q]);if(G.length>0||K.length>0||B.length>0)Z.emit("update",[{added:G,updated:K,removed:B},Q])};var sQ=(Z)=>B4(Z,($,Q)=>`${encodeURIComponent(Q)}=${encodeURIComponent($)}`).join("&");var fZ=0,oQ=3,K8=1,PJ=2,S8=[];S8[fZ]=(Z,$,Q,J,q)=>{W(Z,fZ);let G=lQ($,Z,Q.doc,Q);if(J&&G===N$&&!Q.synced)Q.synced=!0};S8[oQ]=(Z,$,Q,J,q)=>{W(Z,K8),U(Z,G8(Q.awareness,Array.from(Q.awareness.getStates().keys())))};S8[K8]=(Z,$,Q,J,q)=>{dQ(Q.awareness,D($),Q)};S8[PJ]=(Z,$,Q,J,q)=>{iQ($,Q.doc,(G,K)=>TJ(Q,K))};var cQ=30000,TJ=(Z,$)=>console.warn(`Permission denied to access ${Z.url}.
${$}`),aQ=(Z,$,Q)=>{let J=w($),q=A(),G=L(J),K=Z.messageHandlers[G];if(K)K(q,J,Z,Q,G);else console.error("Unable to compute message");return q},x6=(Z,$,Q)=>{if($===Z.ws){if(Z.emit("connection-close",[Q,Z]),Z.ws=null,$.close(),Z.wsconnecting=!1,Z.wsconnected)Z.wsconnected=!1,Z.synced=!1,L$(Z.awareness,Array.from(Z.awareness.getStates().keys()).filter((J)=>J!==Z.doc.clientID),Z),Z.emit("status",[{status:"disconnected"}]);else Z.wsUnsuccessfulReconnects++;setTimeout(nQ,mZ(g6(2,Z.wsUnsuccessfulReconnects)*100,Z.maxBackoffTime),Z)}},nQ=(Z)=>{if(Z.shouldConnect&&Z.ws===null){let $=new Z._WS(Z.url,Z.protocols);$.binaryType="arraybuffer",Z.ws=$,Z.wsconnecting=!0,Z.wsconnected=!1,Z.synced=!1,$.onmessage=(Q)=>{Z.wsLastMessageReceived=u();let J=aQ(Z,new Uint8Array(Q.data),!0);if(m8(J)>1)$.send(E(J))},$.onerror=(Q)=>{Z.emit("connection-error",[Q,Z])},$.onclose=(Q)=>{x6(Z,$,Q)},$.onopen=()=>{Z.wsLastMessageReceived=u(),Z.wsconnecting=!1,Z.wsconnected=!0,Z.wsUnsuccessfulReconnects=0,Z.emit("status",[{status:"connected"}]);let Q=A();if(W(Q,fZ),W$(Q,Z.doc),$.send(E(Q)),Z.awareness.getLocalState()!==null){let J=A();W(J,K8),U(J,G8(Z.awareness,[Z.doc.clientID])),$.send(E(J))}},Z.emit("status",[{status:"connecting"}])}},C6=(Z,$)=>{let Q=Z.ws;if(Z.wsconnected&&Q&&Q.readyState===Q.OPEN)Q.send($);if(Z.bcconnected)bZ(Z.bcChannel,$,Z)};class D6 extends UZ{constructor(Z,$,Q,{connect:J=!0,awareness:q=new I6(Q),params:G={},protocols:K=[],WebSocketPolyfill:X=WebSocket,resyncInterval:B=-1,maxBackoffTime:F=2500,disableBc:_=!1}={}){super();while(Z[Z.length-1]==="/")Z=Z.slice(0,Z.length-1);if(this.serverUrl=Z,this.bcChannel=Z+"/"+$,this.maxBackoffTime=F,this.params=G,this.protocols=K,this.roomname=$,this.doc=Q,this._WS=X,this.awareness=q,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=_,this.wsUnsuccessfulReconnects=0,this.messageHandlers=S8.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=J,this._resyncInterval=0,B>0)this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let H=A();W(H,fZ),W$(H,Q),this.ws.send(E(H))}},B);if(this._bcSubscriber=(H,z)=>{if(z!==this){let M=aQ(this,new Uint8Array(H),!1);if(m8(M)>1)bZ(this.bcChannel,E(M),this)}},this._updateHandler=(H,z)=>{if(z!==this){let M=A();W(M,fZ),uQ(M,H),C6(this,E(M))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:H,updated:z,removed:M},N)=>{let Y=H.concat(z).concat(M),V=A();W(V,K8),U(V,G8(q,Y)),C6(this,E(V))},this._exitHandler=()=>{L$(this.awareness,[Q.clientID],"app closed")},XZ&&typeof process!=="undefined")process.on("exit",this._exitHandler);if(q.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{if(this.wsconnected&&cQ<u()-this.wsLastMessageReceived)x6(this,this.ws,null)},cQ/10),J)this.connect()}get url(){let Z=sQ(this.params);return this.serverUrl+"/"+this.roomname+(Z.length===0?"":"?"+Z)}get synced(){return this._synced}set synced(Z){if(this._synced!==Z)this._synced=Z,this.emit("synced",[Z]),this.emit("sync",[Z])}destroy(){if(this._resyncInterval!==0)clearInterval(this._resyncInterval);if(clearInterval(this._checkInterval),this.disconnect(),XZ&&typeof process!=="undefined")process.off("exit",this._exitHandler);this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;if(!this.bcconnected)fQ(this.bcChannel,this._bcSubscriber),this.bcconnected=!0;let Z=A();W(Z,fZ),W$(Z,this.doc),bZ(this.bcChannel,E(Z),this);let $=A();W($,fZ),A6($,this.doc),bZ(this.bcChannel,E($),this);let Q=A();W(Q,oQ),bZ(this.bcChannel,E(Q),this);let J=A();W(J,K8),U(J,G8(this.awareness,[this.doc.clientID])),bZ(this.bcChannel,E(J),this)}disconnectBc(){let Z=A();if(W(Z,K8),U(Z,G8(this.awareness,[this.doc.clientID],new Map)),C6(this,E(Z)),this.bcconnected)gQ(this.bcChannel,this._bcSubscriber),this.bcconnected=!1}disconnect(){if(this.shouldConnect=!1,this.disconnectBc(),this.ws!==null)x6(this,this.ws,null)}connect(){if(this.shouldConnect=!0,!this.wsconnected&&this.ws===null)nQ(this),this.connectBc()}}window.Y=M$;window.WebsocketProvider=D6;
